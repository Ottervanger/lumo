"use strict";var EventType=require("./event/EventType");module.exports={CLICK:EventType.CLICK,DBL_CLICK:EventType.DBL_CLICK,MOUSE_DOWN:EventType.MOUSE_DOWN,MOUSE_UP:EventType.MOUSE_UP,MOUSE_MOVE:EventType.MOUSE_MOVE,MOUSE_OVER:EventType.MOUSE_OVER,MOUSE_OUT:EventType.MOUSE_OUT,PAN_START:EventType.PAN_START,PAN:EventType.PAN,PAN_END:EventType.PAN_END,ZOOM_START:EventType.ZOOM_START,ZOOM:EventType.ZOOM,ZOOM_END:EventType.ZOOM_END,RESIZE:EventType.RESIZE,FRAME:EventType.FRAME,REFRESH:EventType.REFRESH,TILE_REQUEST:EventType.TILE_REQUEST,TILE_FAILURE:EventType.TILE_FAILURE,TILE_ADD:EventType.TILE_ADD,TILE_DISCARD:EventType.TILE_DISCARD,TILE_REMOVE:EventType.TILE_REMOVE,CELL_UPDATE:EventType.CELL_UPDATE,Event:require("./event/Event"),MouseEvent:require("./event/MouseEvent"),ResizeEvent:require("./event/ResizeEvent"),TileEvent:require("./event/TileEvent"),Bounds:require("./geometry/Bounds"),RTree:require("./geometry/RTree"),RTreePyramid:require("./geometry/RTreePyramid"),CircleCollidable:require("./geometry/CircleCollidable"),RectangleCollidable:require("./geometry/RectangleCollidable"),RingCollidable:require("./geometry/RingCollidable"),Plot:require("./plot/Plot"),Layer:require("./layer/Layer"),TileLayer:require("./layer/tile/TileLayer"),Overlay:require("./layer/overlay/Overlay"),PointOverlay:require("./layer/overlay/PointOverlay"),PolylineOverlay:require("./layer/overlay/PolylineOverlay"),PolygonOverlay:require("./layer/overlay/PolygonOverlay"),Renderer:require("./renderer/Renderer"),TileRenderer:require("./renderer/tile/TileRenderer"),WebGLTileRenderer:require("./renderer/tile/WebGLTileRenderer"),ImageTileRenderer:require("./renderer/tile/sample/ImageTileRenderer"),InteractiveTileRenderer:require("./renderer/tile/sample/InteractiveTileRenderer"),PointTileRenderer:require("./renderer/tile/sample/PointTileRenderer"),InstancedTileRenderer:require("./renderer/tile/sample/InstancedTileRenderer"),OverlayRenderer:require("./renderer/overlay/OverlayRenderer"),WebGLOverlayRenderer:require("./renderer/overlay/WebGLOverlayRenderer"),PointOverlayRenderer:require("./renderer/overlay/sample/PointOverlayRenderer"),PolylineOverlayRenderer:require("./renderer/overlay/sample/PolylineOverlayRenderer"),PolygonOverlayRenderer:require("./renderer/overlay/sample/PolygonOverlayRenderer"),Shader:require("./webgl/shader/Shader"),Texture:require("./webgl/texture/Texture"),TextureArray:require("./webgl/texture/TextureArray"),VertexAtlas:require("./webgl/vertex/VertexAtlas"),VertexBuffer:require("./webgl/vertex/VertexBuffer"),IndexBuffer:require("./webgl/vertex/IndexBuffer"),loadBuffer:require("./util/loadBuffer"),loadImage:require("./util/loadImage")};
"use strict";function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}var Event=function t(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Date.now();_classCallCheck(this,t),this.target=a,this.timestamp=n};module.exports=Event;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var EventBroadcaster=function(){function t(e){_classCallCheck(this,t),this.plot=e}return _createClass(t,[{key:"broadcast",value:function(n){var a=this;this.plot.on(n,function(e){for(var t=a.plot.getSortedLayers(),r=t.length-1;0<=r;r--)t[r].isHidden()||t[r].emit(n,e)})}}]),t}();module.exports=EventBroadcaster;
"use strict";var _DELEGATION_FUNCS;function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var EventType=require("./EventType"),MouseEvent=require("./MouseEvent"),setCursor=function(e){e.getContainer().style.cursor="pointer"},resetCursor=function(e){e.getContainer().style.cursor="inherit"},copyEvent=function(e,t,n){return new MouseEvent(e,n.originalEvent,{x:n.pos.x,y:n.pos.y},{x:n.px.x,y:n.px.y},t)},delegateMouseMove=function(e,t,n,r){var o=[],i=e.prevMouseover;return r?(i&&i.data!==r&&(i.target.unhighlight(),o.push({type:EventType.MOUSE_OUT,event:copyEvent(i.target,i.data,i)})),o.push({type:EventType.MOUSE_MOVE,event:copyEvent(t,r,n)}),setCursor(e.plot),t.highlight(r),i&&i.data===r||o.push({type:EventType.MOUSE_OVER,event:copyEvent(t,r,n)}),e.prevMouseover=o[o.length-1].event):i&&(resetCursor(e.plot),i.target.unhighlight(),o.push({type:EventType.MOUSE_OUT,event:copyEvent(i.target,i.data,i)}),e.prevMouseover=null),o},delegateMouseUp=function(e,t,n,r){return r?[{type:EventType.MOUSE_UP,event:copyEvent(t,r,n)}]:[]},delegateMouseDown=function(e,t,n,r){return r?[{type:EventType.MOUSE_DOWN,event:copyEvent(t,r,n)}]:[]},delegateClick=function(e,t,n,r){var o=n.originalEvent.ctrlKey||n.originalEvent.metaKey;if(r){t.isSelected(r)?o&&t.unselect(r):(o||(e.prevClick.forEach(function(e){e.target.unselectAll()}),e.prevClick=[]),t.select(r,o));var i={type:EventType.CLICK,event:copyEvent(t,r,n)};return e.prevClick.push(i.event),[i]}if(0<e.prevClick.length){if(o)return[];e.prevClick.forEach(function(e){e.target.unselectAll()}),e.prevClick=[]}return[]},delegateDblClick=function(e,t,n,r){return r?[{type:EventType.DBL_CLICK,event:copyEvent(t,r,n)}]:[]},DELEGATION_FUNCS=(_defineProperty(_DELEGATION_FUNCS={},EventType.MOUSE_MOVE,delegateMouseMove),_defineProperty(_DELEGATION_FUNCS,EventType.MOUSE_UP,delegateMouseUp),_defineProperty(_DELEGATION_FUNCS,EventType.MOUSE_DOWN,delegateMouseDown),_defineProperty(_DELEGATION_FUNCS,EventType.CLICK,delegateClick),_defineProperty(_DELEGATION_FUNCS,EventType.DBL_CLICK,delegateDblClick),_DELEGATION_FUNCS),EventDelegator=function(){function t(e){_classCallCheck(this,t),this.plot=e,this.prevClick=[],this.prevMouseover=null}return _createClass(t,[{key:"delegate",value:function(e){var a=this,u=DELEGATION_FUNCS[e];if(!u)throw"Delegation for event type ".concat(e," is not supported");this.plot.on(e,function(e){for(var t=a.plot.getSortedLayers(),n=null,r=null,o=t.length-1;0<=o;o--)if(!t[o].isHidden()&&(n=t[o].pick(e.pos))){r=t[o];break}for(var i=u(a,r,e,n),l=0;l<i.length;l++){var p=i[l];p.event.target.emit(p.type,p.event)}})}}]),t}();module.exports=EventDelegator;
"use strict";module.exports={CLICK:"click",DBL_CLICK:"dblclick",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",MOUSE_MOVE:"mousemove",MOUSE_OVER:"mouseover",MOUSE_OUT:"mouseout",PAN_START:"panstart",PAN:"pan",PAN_END:"panend",ZOOM_START:"zoomstart",ZOOM:"zoom",ZOOM_END:"zoomend",FRAME:"frame",RESIZE:"resize",CELL_UPDATE:"cellupdate",REFRESH:"refresh",TILE_REQUEST:"tilerequest",TILE_FAILURE:"tilefailure",TILE_ADD:"tileadd",TILE_DISCARD:"tilediscard",TILE_REMOVE:"tileremove",LOAD:"load"};
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Event=require("./Event"),MouseEvent=function(t){function u(t,e,o,n){var r,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;return _classCallCheck(this,u),(r=_possibleConstructorReturn(this,_getPrototypeOf(u).call(this,t))).originalEvent=e,r.pos=o,r.px=n,r.data=i,r}return _inherits(u,Event),u}();module.exports=MouseEvent;
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Event=require("./Event"),ResizeEvent=function(t){function r(t,e,o){var n;return _classCallCheck(this,r),(n=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,t))).oldSize=e,n.newSize=o,n}return _inherits(r,Event),r}();module.exports=ResizeEvent;
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Event=require("./Event"),TileEvent=function(t){function n(t,e){var o;return _classCallCheck(this,n),(o=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,t))).tile=e,o}return _inherits(n,Event),n}();module.exports=TileEvent;
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}var INSIDE=0,LEFT=1,RIGHT=2,BOTTOM=4,TOP=8,computeCode=function(t,e,o){var i=INSIDE;return e<t.left?i|=LEFT:e>t.right&&(i|=RIGHT),o<t.bottom?i|=BOTTOM:o>t.top&&(i|=TOP),i},sutherlandHodgemanClip=function(t,e){for(var o,i=1;i<=8;i*=2){o=[];for(var n=e[e.length-1],r=!(computeCode(t,n.x,n.y)&i),h=0;h<e.length;h++){var l=e[h],u=!(computeCode(t,l.x,l.y)&i);if(u!==r){var s=n.x,a=n.y,f=l.x,p=l.y,c=void 0,g=0;i&TOP?(c=s+(f-s)*(t.top-a)/(p-a),g=t.top):i&BOTTOM?(c=s+(f-s)*(t.bottom-a)/(p-a),g=t.bottom):c=i&RIGHT?(g=a+(p-a)*(t.right-s)/(f-s),t.right):(g=a+(p-a)*(t.left-s)/(f-s),t.left),o.push({x:c,y:g})}u&&o.push(l),n=l,r=u}if(!(e=o).length)break}return 0<o.length?o:null},cohenSutherlandClip=function(t,e,o){for(var i=e.x,n=e.y,r=o.x,h=o.y,l=computeCode(t,i,n),u=computeCode(t,r,h),s=!1,a=0;a<8;){if(!(l|u)){s=!0;break}if(l&u)break;var f=void 0,p=0,c=l||u;c&TOP?(f=i+(r-i)*(t.top-n)/(h-n),p=t.top):c&BOTTOM?(f=i+(r-i)*(t.bottom-n)/(h-n),p=t.bottom):f=c&RIGHT?(p=n+(h-n)*(t.right-i)/(r-i),t.right):(p=n+(h-n)*(t.left-i)/(r-i),t.left),c===l?l=computeCode(t,i=f,n=p):u=computeCode(t,r=f,h=p),a++}return s?[{x:i,y:n},{x:r,y:h}]:null},Bounds=function(){function n(t,e,o,i){_classCallCheck(this,n),this.left=t,this.right=e,this.bottom=o,this.top=i}return _createClass(n,[{key:"getWidth",value:function(){return this.right-this.left}},{key:"getHeight",value:function(){return this.top-this.bottom}},{key:"extend",value:function(t){void 0!==t.left&&void 0!==t.right&&void 0!==t.bottom&&void 0!==t.top?(t.left<this.left&&(this.left=t.left),t.right>this.right&&(this.right=t.right),t.bottom<this.bottom&&(this.bottom=t.bottom),t.top>this.top&&(this.top=t.top)):(t.x<this.left&&(this.left=t.x),t.x>this.right&&(this.right=t.x),t.y<this.bottom&&(this.bottom=t.y),t.y>this.top&&(this.top=t.y))}},{key:"getCenter",value:function(){return{x:this.left+this.getWidth()/2,y:this.bottom+this.getHeight()/2}}},{key:"equals",value:function(t){return this.left===t.left&&this.right===t.right&&this.bottom===t.bottom&&this.top===t.top}},{key:"overlaps",value:function(t){return!(this.left>t.right||this.right<t.left||this.top<t.bottom||this.bottom>t.top)}},{key:"intersection",value:function(t){if(this.overlaps(t))return new n(Math.max(this.left,t.left),Math.min(this.right,t.right),Math.max(this.bottom,t.bottom),Math.min(this.top,t.top))}},{key:"clipLine",value:function(t){return t&&2===t.length?cohenSutherlandClip(this,t[0],t[1]):null}},{key:"clipPolyline",value:function(t){if(!t||t.length<2)return null;for(var e=[],o=[],i=1;i<t.length;i++){var n=t[i-1],r=t[i],h=cohenSutherlandClip(this,n,r);if(h){var l=h[0],u=h[1];o.push(l),(u.x!==r.x&&u.y!==r.y||i===t.length-1)&&(o.push(u),e.push(o),o=[])}}return 0<e.length?e:null}},{key:"clipPoints",value:function(t){if(!t)return null;for(var e=[],o=0;o<t.length;o++){var i=t[o];i.x>=this.left&&i.x<=this.right&&i.y>=this.bottom&&i.y<=this.top&&e.push(i)}return 0<e.length?e:null}},{key:"clipPolygon",value:function(t){return!t||t.length<3?null:sutherlandHodgemanClip(this,t)}}]),n}();module.exports=Bounds;
"use strict";function _classCallCheck(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(i,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}}function _createClass(i,e,t){return e&&_defineProperties(i.prototype,e),t&&_defineProperties(i,t),i}var clamp=require("lodash/clamp"),CircleCollidable=function(){function l(i,e,t,a,s,r,n){_classCallCheck(this,l),this.x=i,this.y=e,this.radius=t,this.minX=i+a-t,this.maxX=i+a+t,this.minY=e+s-t,this.maxY=e+s+t,this.tile=r,this.data=n}return _createClass(l,[{key:"testPoint",value:function(i,e){var t=.5*(this.minX+this.maxX)-i,a=.5*(this.minY+this.maxY)-e;return t*t+a*a<=this.radius*this.radius}},{key:"testRectangle",value:function(i,e,t,a){var s=.5*(this.minX+this.maxX),r=.5*(this.minY+this.maxY),n=s-clamp(s,i,e),l=r-clamp(r,t,a);return n*n+l*l<this.radius*this.radius}}]),l}();module.exports=CircleCollidable;
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}var rbush=require("rbush"),defaultTo=require("lodash/defaultTo"),RTree=function(){function r(e){_classCallCheck(this,r),this.tree=rbush(defaultTo(e.nodeCapacity,32))}return _createClass(r,[{key:"insert",value:function(e){this.tree.load(e)}},{key:"remove",value:function(e){for(var r=this.tree,t=0;t<e.length;t++)r.remove(e[t])}},{key:"searchPoint",value:function(e,r){var t=this.tree.search({minX:e,maxX:e,minY:r,maxY:r});if(0===t.length)return null;for(var n=0;n<t.length;n++){var a=t[n];if(a.testPoint(e,r))return a}return null}},{key:"searchRectangle",value:function(e,r,t,n){var a=this.tree.search({minX:e,maxX:r,minY:t,maxY:n});if(0===a.length)return null;for(var i=0;i<a.length;i++){var l=a[i];if(l.testRectangle(e,r,t,n))return l}return null}}]),r}();module.exports=RTree;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var defaultTo=require("lodash/defaultTo"),RTree=require("./RTree"),RTreePyramid=function(){function t(e){_classCallCheck(this,t),this.trees=new Map,this.collidables=new Map,this.nodeCapacity=defaultTo(e.nodeCapacity,32)}return _createClass(t,[{key:"insert",value:function(e,t){return this.trees.has(e.z)||this.trees.set(e.z,new RTree({nodeCapacity:this.nodeCapacity})),this.trees.get(e.z).insert(t),this.collidables.set(e.hash,t),this}},{key:"remove",value:function(e){var t=this.collidables.get(e.hash);return this.trees.get(e.z).remove(t),this.collidables.delete(e.hash),this}},{key:"searchPoint",value:function(e,t,r,a){var n=Math.round(r),s=this.trees.get(n);if(!s)return null;var i=Math.pow(2,n-r),l=e*a*i,o=t*a*i;return s.searchPoint(l,o)}},{key:"searchRectangle",value:function(e,t,r,a,n,s){var i=Math.round(n),l=this.trees.get(i);if(!l)return null;var o=Math.pow(2,i-n),u=e*s*o,c=t*s*o,h=r*s*o,f=a*s*o;return l.searchRectangle(u,c,h,f)}}]),t}();module.exports=RTreePyramid;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var RectangleCollidable=function(){function o(e,t,n,a,i,r,l,s){_classCallCheck(this,o),this.minX=e+i,this.maxX=t+i,this.minY=n+r,this.maxY=a+r,this.tile=l,this.data=s}return _createClass(o,[{key:"testPoint",value:function(e,t){return!0}},{key:"testRectangle",value:function(e,t,n,a){return!0}}]),o}();module.exports=RectangleCollidable;
"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,i){for(var a=0;a<i.length;a++){var e=i[a];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function _createClass(t,i,a){return i&&_defineProperties(t.prototype,i),a&&_defineProperties(t,a),t}var clamp=require("lodash/clamp"),RingCollidable=function(){function u(t,i,a,e,s,r,n,h){_classCallCheck(this,u),this.x=t,this.y=i,this.radius=a;var l=.5*(this.width=e);this.minX=t+s-a-l,this.maxX=t+s+a+l,this.minY=i+r-a-l,this.maxY=i+r+a+l,this.tile=n,this.data=h}return _createClass(u,[{key:"testPoint",value:function(t,i){var a=.5*(this.minX+this.maxX)-t,e=.5*(this.minY+this.maxY)-i,s=a*a+e*e,r=.5*this.width,n=this.radius-r,h=this.radius+r;return s<=h*h&&n*n<=s}},{key:"testRectangle",value:function(t,i,a,e){var s=.5*(this.minX+this.maxX),r=.5*(this.minY+this.maxY),n=s-(Math.abs(s-t)<Math.abs(s-i)?i:t),h=r-(Math.abs(r-a)<Math.abs(r-e)?e:a),l=.5*this.width,u=this.radius-l;if(n*n+h*h<u*u)return!1;var o=s-clamp(s,t,i),c=r-clamp(r,a,e),m=this.radius+l;return o*o+c*c<m*m}}]),u}();module.exports=RingCollidable;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var clamp=require("lodash/clamp"),defaultTo=require("lodash/defaultTo"),EventEmitter=require("events"),Event=require("../event/Event"),EventType=require("../event/EventType"),Layer=function(e){function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this))).opacity=defaultTo(t.opacity,1),e.hidden=defaultTo(t.hidden,!1),e.zIndex=defaultTo(t.zIndex,0),e.renderer=defaultTo(t.renderer,null),e.highlighted=null,e.selected=[],e.plot=null,e}return _inherits(r,EventEmitter),_createClass(r,[{key:"onAdd",value:function(e){if(!e)throw"No plot argument provided";return this.plot=e,this.plot.setDirty(),this.renderer&&this.renderer.onAdd(this),this}},{key:"onRemove",value:function(e){if(!e)throw"No plot argument provided";return this.renderer&&this.renderer.onRemove(this),this.clear(),this.plot.setDirty(),this.plot=null,this}},{key:"setRenderer",value:function(e){if(!e)throw"No renderer argument provided";return this.renderer&&this.plot&&this.renderer.onRemove(this),this.renderer=e,this.plot&&this.renderer.onAdd(this),this}},{key:"removeRenderer",value:function(){if(!this.renderer)throw"No renderer is currently attached to the layer";return this.plot&&this.renderer.onRemove(this),this.renderer=null,this}},{key:"getRenderer",value:function(){return this.renderer}},{key:"setOpacity",value:function(e){return e=clamp(e,0,1),this.opacity!==e&&(this.opacity=e,this.plot&&this.plot.setDirty()),this}},{key:"getOpacity",value:function(){return this.opacity}},{key:"setZIndex",value:function(e){return this.zIndex!==e&&(this.zIndex=e,this.plot&&this.plot.setDirty()),this}},{key:"getZIndex",value:function(){return this.zIndex}},{key:"show",value:function(){return this.hidden&&(this.hidden=!1,this.plot&&this.plot.setDirty()),this}},{key:"hide",value:function(){return this.hidden||(this.hidden=!0,this.renderer&&this.renderer.clear(),this.plot&&this.plot.setDirty()),this}},{key:"isHidden",value:function(){return this.hidden}},{key:"pick",value:function(e){return this.renderer?this.renderer.pick(e):null}},{key:"highlight",value:function(e){return this.highlighted!==e&&(this.highlighted=e,this.plot&&this.plot.setDirty()),this}},{key:"unhighlight",value:function(){return null!==this.highlighted&&(this.highlighted=null,this.plot&&this.plot.setDirty()),this}},{key:"getHighlighted",value:function(){return this.highlighted}},{key:"isHighlighted",value:function(e){return this.highlighted===e}},{key:"select",value:function(e,t){var r=!1;t?-1===this.selected.indexOf(e)&&(this.selected.push(e),r=!0):1===this.selected.length&&this.selected[0]===e||(this.selected=[e],r=!0);return this.plot&&r&&this.plot.setDirty(),this}},{key:"unselect",value:function(e){var t=this.selected.indexOf(e);return-1!==t&&(this.selected.splice(t,1),this.plot&&this.plot.setDirty()),this}},{key:"unselectAll",value:function(){return 0<this.selected.length&&(this.selected=[],this.plot&&this.plot.setDirty()),this}},{key:"getSelected",value:function(){return this.selected}},{key:"isSelected",value:function(e){return-1!==this.selected.indexOf(e)}},{key:"draw",value:function(e){return this.renderer&&this.renderer.draw(e),this}},{key:"clear",value:function(){return(this.highlighted||0<this.selected.length)&&(this.highlighted=null,this.selected=[]),this.renderer&&this.renderer.clear(),this.plot&&this.plot.setDirty(),this}},{key:"refresh",value:function(){return this.clear(),this.emit(EventType.REFRESH,new Event(this)),this}}]),r}();module.exports=Layer;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}var Bounds=require("../geometry/Bounds"),CELL_SIZE=Math.pow(2,16),CELL_HALF_SIZE=CELL_SIZE/2,Cell=function(){function i(e,t,o){_classCallCheck(this,i);var n=CELL_HALF_SIZE/o,s={x:t.x-n,y:t.y-n};this.zoom=e,this.halfSize=n,this.center=t,this.offset=s,this.extent=o,this.bounds=new Bounds(t.x-n,t.x+n,t.y-n,t.y+n)}return _createClass(i,[{key:"project",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.zoom,o=Math.pow(2,t-this.zoom)*this.extent;return{x:(e.x-this.offset.x)*o,y:(e.y-this.offset.y)*o}}},{key:"unproject",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.zoom,o=Math.pow(2,t-this.zoom)*this.extent;return{x:e.x/o+this.offset.x,y:e.y/o+this.offset.y}}}]),i}();module.exports=Cell;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var clamp=require("lodash/clamp"),defaultTo=require("lodash/defaultTo"),throttle=require("lodash/throttle"),EventEmitter=require("events"),EventType=require("../event/EventType"),EventBroadcaster=require("../event/EventBroadcaster"),EventDelegator=require("../event/EventDelegator"),Event=require("../event/Event"),ResizeEvent=require("../event/ResizeEvent"),RenderBuffer=require("../webgl/RenderBuffer"),ClickHandler=require("./handler/ClickHandler"),MouseHandler=require("./handler/MouseHandler"),PanHandler=require("./handler/PanHandler"),ZoomHandler=require("./handler/ZoomHandler"),Cell=require("./Cell"),Viewport=require("./Viewport"),PAN_THROTTLE_MS=100,RESIZE_THROTTLE_MS=200,ZOOM_THROTTLE_MS=400,CELL_ZOOM_DELTA=1,MAX_ZOOM=24,CLICK=Symbol(),MOUSE=Symbol(),PAN=Symbol(),ZOOM=Symbol(),HANDLERS=Symbol(),DELEGATOR=Symbol(),BROADCASTER=Symbol(),DIRTY=Symbol(),requestTiles=function(){var t=this.getTargetVisibleCoords();return this.layers.forEach(function(e){e.requestTiles&&e.requestTiles(t)}),this},resize=function(e){var t={width:e.container.offsetWidth,height:e.container.offsetHeight},i=e.getViewportPixelSize(),n=e.viewport.getCenter();if(i.width!==t.width||i.height!==t.height||e.pixelRatio!==window.devicePixelRatio){e.pixelRatio=window.devicePixelRatio,e.canvas.style.width=t.width+"px",e.canvas.style.height=t.height+"px",e.canvas.width=t.width*e.pixelRatio,e.canvas.height=t.height*e.pixelRatio,e.renderBuffer&&e.renderBuffer.resize(t.width*e.pixelRatio,t.height*e.pixelRatio);var r=e.getPixelExtent();e.viewport.width=t.width/r,e.viewport.height=t.height/r,e.viewport.centerOn(n),e.resizeRequest(),e.setDirty(),e.emit(EventType.RESIZE,new ResizeEvent(e,i,t))}},updateCell=function(e){var t=e.getTargetZoom(),i=e.getTargetViewportCenter(),n=e.getTargetPixelExtent(),r=e.getViewportPixelSize(),o=new Cell(t,i,n),a=!1;if(e.cell){var s=Math.abs(e.cell.zoom-o.zoom);if(CELL_ZOOM_DELTA<=s)a=!0;else{var l=e.cell.halfSize-r.width/e.cell.extent,u=e.cell.halfSize-r.height/e.cell.extent;(Math.abs(o.center.x-e.cell.center.x)>l||Math.abs(o.center.y-e.cell.center.y)>u)&&(a=!0)}}else a=!0;a&&(e.cell=o,e.emit(EventType.CELL_UPDATE,new Event(o)))},reset=function(e){if(e.wraparound){var t=Math.ceil(e.viewport.width/1);1<e.viewport.x&&(e.viewport.x-=t,e.isPanning()&&(e.panAnimation.start.x-=t)),e.viewport.x+e.viewport.width<0&&(e.viewport.x+=t,e.isPanning()&&(e.panAnimation.start.x+=t))}},prepareFrame=function(e){var t=e.getRenderingContext();if(t){t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT);var i=e.getViewportPixelSize();t.viewport(0,0,i.width*e.pixelRatio,i.height*e.pixelRatio)}},frame=function e(t){var i=Date.now();(t.emit(EventType.FRAME,new Event(t,i)),resize(t),!t.dirtyChecking||t.isDirty())&&(t.clearDirty(),t.isZooming()&&t.zoomAnimation.update(i)&&(t.zoomAnimation=null),t.isPanning()&&(t.panAnimation.update(i)&&(t.panAnimation=null),t.panRequest()),reset(t),updateCell(t),prepareFrame(t),t.getSortedLayers().forEach(function(e){e.isHidden()||e.draw(i)}));t.frameRequest=requestAnimationFrame(function(){e(t)})},Plot=function(e){function h(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,h),(t=_possibleConstructorReturn(this,_getPrototypeOf(h).call(this))).container=document.querySelector(e),!t.container)throw"Element could not be found for selector ".concat(e);if(t.pixelRatio=window.devicePixelRatio,t.canvas=document.createElement("canvas"),t.canvas.style.width="".concat(t.container.offsetWidth,"px"),t.canvas.style.height="".concat(t.container.offsetHeight,"px"),t.canvas.width=t.container.offsetWidth*t.pixelRatio,t.canvas.height=t.container.offsetHeight*t.pixelRatio,t.container.appendChild(t.canvas),t.ctx=t.canvas.getContext("webgl",i.contextAttributes)||t.canvas.getContext("experimental-webgl",i.contextAttributes),!t.ctx&&!i.noContext)throw"Unable to create a WebGLRenderingContext, please ensure your browser supports WebGL";t.ctx?t.renderBuffer=new RenderBuffer(t.ctx,t.canvas.width,t.canvas.height):t.renderBuffer=null,t.tileSize=defaultTo(i.tileSize,256),t.minZoom=defaultTo(i.minZoom,0),t.maxZoom=defaultTo(i.maxZoom,MAX_ZOOM),t.zoom=defaultTo(i.zoom,0),t.zoom=clamp(t.zoom,t.minZoom,t.maxZoom);var n=Math.pow(2,t.zoom),r=t.canvas.offsetWidth/n,o=t.canvas.offsetHeight/n;t.viewport=new Viewport(0,0,r,o);var a=defaultTo(i.center,{x:.5,y:.5});t.viewport.centerOn(a),t.cell=null,updateCell(_assertThisInitialized(_assertThisInitialized(t))),t.wraparound=defaultTo(i.wraparound,!1);var s=defaultTo(i.panThrottle,PAN_THROTTLE_MS),l=defaultTo(i.resizeThrottle,RESIZE_THROTTLE_MS),u=defaultTo(i.zoomThrottle,ZOOM_THROTTLE_MS);return t.panRequest=throttle(requestTiles,s,{leading:!1}),t.resizeRequest=throttle(requestTiles,l,{leading:!1}),t.zoomRequest=throttle(requestTiles,u,{leading:!1}),t.layers=[],t.frameRequest=null,t[HANDLERS]=new Map,t[HANDLERS].set(CLICK,new ClickHandler(_assertThisInitialized(_assertThisInitialized(t)),i)),t[HANDLERS].set(MOUSE,new MouseHandler(_assertThisInitialized(_assertThisInitialized(t)),i)),t[HANDLERS].set(PAN,new PanHandler(_assertThisInitialized(_assertThisInitialized(t)),i)),t[HANDLERS].set(ZOOM,new ZoomHandler(_assertThisInitialized(_assertThisInitialized(t)),i)),t[HANDLERS].forEach(function(e){e.enable()}),t[DELEGATOR]=new EventDelegator(_assertThisInitialized(_assertThisInitialized(t))),t[DELEGATOR].delegate(EventType.CLICK),t[DELEGATOR].delegate(EventType.DBL_CLICK),t[DELEGATOR].delegate(EventType.MOUSE_MOVE),t[DELEGATOR].delegate(EventType.MOUSE_UP),t[DELEGATOR].delegate(EventType.MOUSE_DOWN),t[BROADCASTER]=new EventBroadcaster(_assertThisInitialized(_assertThisInitialized(t))),t[BROADCASTER].broadcast(EventType.ZOOM_START),t[BROADCASTER].broadcast(EventType.ZOOM),t[BROADCASTER].broadcast(EventType.ZOOM_END),t[BROADCASTER].broadcast(EventType.PAN_START),t[BROADCASTER].broadcast(EventType.PAN),t[BROADCASTER].broadcast(EventType.PAN_END),t.dirtyChecking=defaultTo(i.dirtyChecking,!0),t[DIRTY]=!0,frame(_assertThisInitialized(_assertThisInitialized(t))),t}return _inherits(h,EventEmitter),_createClass(h,[{key:"destroy",value:function(){var t=this;return cancelAnimationFrame(this.frameRequest),this.frameRequest=null,this[HANDLERS].forEach(function(e){e.disable()}),this.layers.forEach(function(e){t.remove(e)}),this.ctx=null,this.container.removeChild(this.canvas),this.canvas=null,this.container=null,this.renderBuffer=null,this}},{key:"setDirty",value:function(){this[DIRTY]=!0}},{key:"isDirty",value:function(){return this[DIRTY]||this.isPanning()||this.isZooming()}},{key:"clearDirty",value:function(){this[DIRTY]=!1}},{key:"add",value:function(e){if(!e)throw"No argument provided";if(-1!==this.layers.indexOf(e))throw"Provided layer is already attached to the plot";return this.layers.push(e),e.onAdd(this),this.setDirty(),this}},{key:"remove",value:function(e){if(!e)throw"No argument provided";var t=this.layers.indexOf(e);if(-1===t)throw"Provided layer is not attached to the plot";return this.layers.splice(t,1),e.onRemove(this),this.setDirty(),this}},{key:"getRenderingContext",value:function(){return this.ctx}},{key:"getSortedLayers",value:function(){return this.layers.sort(function(e,t){return e.getZIndex()-t.getZIndex()})}},{key:"getZoom",value:function(){return this.zoom}},{key:"getTargetZoom",value:function(){return this.isZooming()?this.zoomAnimation.targetZoom:this.zoom}},{key:"getViewport",value:function(){return this.viewport}},{key:"getTargetViewport",value:function(){return this.isZooming()?this.zoomAnimation.targetViewport:this.viewport}},{key:"getViewportPosition",value:function(){return this.viewport.getPosition()}},{key:"getTargetViewportPosition",value:function(){return this.getTargetViewport().getPosition()}},{key:"getViewportCenter",value:function(){return this.viewport.getCenter()}},{key:"getTargetViewportCenter",value:function(){return this.getTargetViewport().getCenter()}},{key:"getTargetVisibleCoords",value:function(){var e=Math.round(this.getTargetZoom());return this.getTargetViewport().getVisibleCoords(e,this.wraparound)}},{key:"getVisibleCoords",value:function(){var e=Math.round(this.zoom);return this.viewport.getVisibleCoords(e,this.wraparound)}},{key:"getPixelExtent",value:function(){return Math.pow(2,this.zoom)*this.tileSize}},{key:"getTargetPixelExtent",value:function(){return Math.pow(2,this.getTargetZoom())*this.tileSize}},{key:"getViewportPixelSize",value:function(){return this.viewport.getPixelSize(this.zoom,this.tileSize)}},{key:"getTargetViewportPixelSize",value:function(){return this.getTargetViewport().getPixelSize(this.zoom,this.tileSize)}},{key:"getViewportPixelOffset",value:function(){return this.viewport.getPixelOffset(this.zoom,this.tileSize)}},{key:"getTargetViewportPixelOffset",value:function(){return this.getTargetViewport().getPixelOffset(this.zoom,this.tileSize)}},{key:"mouseToPlotCoord",value:function(e){var t=this.getPixelExtent(),i=this.getViewportPixelSize(),n=this.getContainer().getBoundingClientRect(),r=e.pageX-n.left,o=e.pageY-n.top;return{x:this.viewport.x+r/t,y:this.viewport.y+(i.height-o)/t}}},{key:"mouseToViewportPixel",value:function(e){var t=this.getViewportPixelSize(),i=this.getContainer().getBoundingClientRect(),n=e.pageX-i.left,r=e.pageY-i.top;return{x:n,y:t.height-r}}},{key:"viewportPixelToPlotCoord",value:function(e){var t=this.getPixelExtent();return{x:e.x/t,y:e.y/t}}},{key:"plotCoordToViewportPixel",value:function(e){var t=this.plot.getPixelExtent();return{x:e.x*t,y:e.y*t}}},{key:"getOrthoMatrix",value:function(){var e=this.getViewportPixelSize(),t=e.width,i=e.height,n=1/(0-t),r=1/(0-i),o=new Float32Array(16);return o[0]=-2*n,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*r,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-1,o[11]=0,o[12]=(0+t)*n,o[13]=(i+0)*r,o[14]=-0,o[15]=1,o}},{key:"panTo",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this.cancelPan(),this.cancelZoom(),this[HANDLERS].get(PAN).panTo(e,t),this.setDirty(),this}},{key:"zoomTo",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this.cancelPan(),this.cancelZoom(),this[HANDLERS].get(ZOOM).zoomTo(e,t),this.setDirty(),this}},{key:"zoomToPosition",value:function(e,t){var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];return this.cancelPan(),this.cancelZoom(),this[HANDLERS].get(ZOOM).zoomToPosition(e,t,i),this.setDirty(),this}},{key:"fitToBounds",value:function(e){var t=this.getTargetZoom(),i=this.getTargetViewport(),n=i.width/e.getWidth(),r=i.height/e.getHeight(),o=Math.min(n,r),a=Math.log2(o)+t;a=clamp(a,this.minZoom,this.maxZoom),this.continuousZoom||(a=Math.floor(a));var s=e.getCenter();return this.zoomTo(a,!1),this.panTo(s,!1),this.setDirty(),this}},{key:"isPanning",value:function(){return!!this.panAnimation}},{key:"isZooming",value:function(){return!!this.zoomAnimation}},{key:"cancelPan",value:function(){return!!this.isPanning()&&(this.panAnimation.cancel(),!(this.panAnimation=null))}},{key:"cancelZoom",value:function(){return!!this.isZooming()&&(this.zoomAnimation.cancel(),!(this.zoomAnimation=null))}},{key:"enablePanning",value:function(){this[HANDLERS].get(PAN).enable()}},{key:"disablePanning",value:function(){this[HANDLERS].get(PAN).disable()}},{key:"enableZooming",value:function(){this[HANDLERS].get(ZOOM).enable()}},{key:"disableZooming",value:function(){this[HANDLERS].get(ZOOM).disable()}},{key:"getHighlighted",value:function(){for(var e=this.layers,t=0;t<e.length;t++){var i=e[t].getHighlighted();if(i)return i}return null}},{key:"isHighlighted",value:function(e){for(var t=this.layers,i=0;i<t.length;i++)if(t[i].isHighlighted(e))return!0;return!1}},{key:"getSelected",value:function(){for(var e=[],t=this.layers,i=0;i<t.length;i++)for(var n=t[i].getSelected(),r=0;r<n.length;r++)e.push(n[r]);return e}},{key:"isSelected",value:function(e){for(var t=this.layers,i=0;i<t.length;i++)if(t[i].isSelected(e))return!0;return!1}},{key:"getContainer",value:function(){return this.container}}]),h}();module.exports=Plot;
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var Bounds=require("../geometry/Bounds"),TileCoord=require("../layer/tile/TileCoord"),getVisibleTileBounds=function(t,e,i){var n=t.getTileBounds(e),r=Math.pow(2,e)-1,h=new Bounds(i?-1/0:0,i?1/0:r,0,r);if(n.overlaps(h)){var o=i?n.left:Math.max(0,n.left),s=i?n.right:Math.min(r,n.right),a=Math.max(0,n.bottom),u=Math.min(r,n.top);return new Bounds(o,s,a,u)}},isWithinRange=function(t,e,i,n){return t<=n&&n<=e||(n<t?n+Math.ceil((t-n)/i)*i<=e:t<=n-Math.ceil((n-e)/i)*i)},Viewport=function(){function a(t,e,i,n){_classCallCheck(this,a),this.x=t,this.y=e,this.width=i,this.height=n}return _createClass(a,[{key:"getTileBounds",value:function(t){var e=1/Math.pow(2,t);return new Bounds(Math.floor(this.x/e),Math.ceil((this.x+this.width)/e)-1,Math.floor(this.y/e),Math.ceil((this.y+this.height)/e)-1)}},{key:"getVisibleCoords",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=getVisibleTileBounds(this,t,e);if(!i)return[];for(var n=[],r=i.left;r<=i.right;r++)for(var h=i.bottom;h<=i.top;h++)n.push(new TileCoord(t,r,h));return n}},{key:"isInView",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=getVisibleTileBounds(this,t.z,e);if(!i)return!1;var n=Math.pow(2,t.z);return isWithinRange(i.left,i.right,n,t.x)&&isWithinRange(i.bottom,i.top,n,t.y)}},{key:"zoomToPos",value:function(t,e,i){var n=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],r=Math.pow(2,e-t),h=this.width/r,o=this.height/r,s=new a(i.x-(i.x-this.x)/r,i.y-(i.y-this.y)/r,h,o);return n||s.centerOn(i),s}},{key:"getPosition",value:function(){return{x:this.x,y:this.y}}},{key:"getCenter",value:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}}},{key:"getPixelSize",value:function(t,e){var i=Math.pow(2,t)*e;return{width:Math.round(this.width*i),height:Math.round(this.height*i)}}},{key:"getPixelOffset",value:function(t,e){var i=Math.pow(2,t)*e;return{x:this.x*i,y:this.y*i}}},{key:"centerOn",value:function(t){this.x=t.x-this.width/2,this.y=t.y-this.height/2}}]),a}();module.exports=Viewport;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var EventEmitter=require("events"),Renderer=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))}return _inherits(t,EventEmitter),_createClass(t,[{key:"onAdd",value:function(e){return this}},{key:"onRemove",value:function(e){return this}},{key:"pick",value:function(e){return null}},{key:"clear",value:function(){return this}},{key:"draw",value:function(e){return this}}]),t}();module.exports=Renderer;
"use strict";var userAgent=(navigator&&navigator.userAgent||"").toLowerCase(),vendor=(navigator&&navigator.vendor||"").toLowerCase(),isFirefox=function(){return userAgent.match(/(?:firefox|fxios)\/(\d+)/)},isChrome=function(){return/google inc/.test(vendor)?userAgent.match(/(?:chrome|crios)\/(\d+)/):null},isIE=function(){return userAgent.match(/(?:msie |trident.+?; rv:)(\d+)/)},isEdge=function(){return userAgent.match(/edge\/(\d+)/)},isOpera=function(){return userAgent.match(/(?:^opera.+?version|opr)\/(\d+)/)},isSafari=function(){return userAgent.match(/version\/(\d+).+?safari/)};module.exports={firefox:!!isFirefox(),chrome:!!isChrome(),ie:!!isIE(),edge:!!isEdge(),opera:!!isOpera(),safari:!!isSafari()};
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var defaultTo=require("lodash/defaultTo"),LinkedList=require("./LinkedList"),CAPACITY=Symbol(),ON_REMOVE=Symbol(),CACHE=Symbol(),LRU_LIST=Symbol(),LENGTH=Symbol(),del=function(e,t){if(t){var i=t.value;e[ON_REMOVE]&&e[ON_REMOVE](i.value,i.key),e[LENGTH]--,e[CACHE].delete(i.key),e[LRU_LIST].removeNode(t)}},LRUCache=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this[CAPACITY]=defaultTo(Math.max(1,e.capacity),256),this[ON_REMOVE]=defaultTo(e.onRemove,null),this.clear()}return _createClass(t,[{key:"getCapacity",value:function(){return this[CAPACITY]}},{key:"getLength",value:function(){return this[LENGTH]}},{key:"forEach",value:function(e){for(var t=this[LRU_LIST].head;null!==t;){var i=t.next;e(t.value.value,t.value.key),t=i}}},{key:"clear",value:function(){var t=this;this[ON_REMOVE]&&this[LRU_LIST]&&this[LRU_LIST].forEach(function(e){t[ON_REMOVE](e.value,e.key)}),this[CACHE]=new Map,this[LRU_LIST]=new LinkedList,this[LENGTH]=0}},{key:"set",value:function(e,t){if(this[CACHE].has(e)){var i=this[CACHE].get(e).value;return this[ON_REMOVE]&&this[ON_REMOVE](i.value,e),i.value=t,void this.get(e)}var a=new Entry(e,t);this[LENGTH]++,this[LRU_LIST].unshift(a),this[CACHE].set(e,this[LRU_LIST].head),this[LENGTH]>this[CAPACITY]&&del(this,this[LRU_LIST].tail)}},{key:"has",value:function(e){return!!this[CACHE].has(e)}},{key:"get",value:function(e){var t=this[CACHE].get(e);if(t)return this[LRU_LIST].unshiftNode(t),t.value.value}},{key:"peek",value:function(e){var t=this[CACHE].get(e);if(t)return t.value.value}},{key:"delete",value:function(e){del(this,this[CACHE].get(e))}}]),t}(),Entry=function e(t,i){_classCallCheck(this,e),this.key=t,this.value=i};module.exports=LRUCache;
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var h=e[i];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var LinkedList=function(){function t(){_classCallCheck(this,t),this.tail=null,this.head=null,this.length=0}return _createClass(t,[{key:"push",value:function(t){return this.tail=new Node(t,this.tail,null,this),this.head||(this.head=this.tail),this.length++,this.length}},{key:"unshift",value:function(t){return this.head=new Node(t,null,this.head,this),this.tail||(this.tail=this.head),this.length++,this.length}},{key:"pop",value:function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}}},{key:"shift",value:function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}}},{key:"get",value:function(t){var e,i;for(e=0,i=this.head;null!==i&&e<t;e++)i=i.next;if(e===t&&null!==i)return i.value}},{key:"forEach",value:function(t){for(var e=this.head,i=0;null!==e;i++)t(e.value,i),e=e.next}},{key:"map",value:function(t){for(var e=new Array(this.length),i=0,h=this.head;null!==h;i++)e[i]=t(h.value,i),h=h.next;return e}},{key:"pushNode",value:function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;return t.list=this,(t.prev=e)&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++,this.length}}},{key:"unshiftNode",value:function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;return t.list=this,(t.next=e)&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++,this.length}}},{key:"removeNode",value:function(t){if(t.list!==this)throw"Removing node which does not belong to this list";var e=t.next,i=t.prev;return e&&(e.prev=i),i&&(i.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=i),t.list.length--,t.next=null,t.prev=null,t.list=null,this.length}}]),t}(),Node=function t(e,i,h,l){_classCallCheck(this,t),this.list=l,this.value=e,i?(i.next=this).prev=i:this.prev=null,h?(h.prev=this).next=h:this.next=null};module.exports=LinkedList;
"use strict";module.exports=function(r,n){var o=new XMLHttpRequest;o.open("GET",r,!0),o.responseType="arraybuffer",o.onload=function(){var r=o.response;if(r)n(null,r);else{var e="Unable to load ArrayBuffer from URL: `".concat(event.path[0].currentSrc,"`");n(e,null)}},o.onerror=function(r){var e="Unable to load ArrayBuffer from URL: `".concat(r.path[0].currentSrc,"`");n(e,null)},o.withCredentials=!0,o.send(null)};
"use strict";module.exports=function(n,r){var o=new Image;o.onload=function(){r(null,o)},o.onerror=function(n){var o="Unable to load image from URL: `".concat(n.path[0].currentSrc,"`");r(o,null)},o.crossOrigin="anonymous",o.src=n};
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var Texture=require("./texture/Texture"),Shader=require("./shader/Shader"),VertexBuffer=require("./vertex/VertexBuffer"),SHADER_GLSL={vert:"\n\t\tprecision highp float;\n\t\tattribute vec3 aVertexPosition;\n\t\tattribute vec2 aTextureCoord;\n\t\tvarying vec2 vTextureCoord;\n\t\tvoid main(void) {\n\t\t\tvTextureCoord = aTextureCoord;\n\t\t\tgl_Position = vec4(aVertexPosition, 1.0);\n\t\t}\n\t\t",frag:"\n\t\tprecision highp float;\n\t\tuniform float uOpacity;\n\t\tuniform sampler2D uTextureSampler;\n\t\tvarying vec2 vTextureCoord;\n\t\tvoid main(void) {\n\t\t\tvec4 color = texture2D(uTextureSampler, vTextureCoord);\n\t\t\tgl_FragColor = vec4(color.rgb, color.a * uOpacity);\n\t\t}\n\t\t"},createQuad=function(e,t,r){var n=new Float32Array(24);return n[0]=t,n[1]=t,n[2]=r,n[3]=t,n[4]=r,n[5]=r,n[6]=t,n[7]=t,n[8]=r,n[9]=r,n[10]=t,n[11]=r,n[12]=0,n[13]=0,n[14]=1,n[15]=0,n[16]=1,n[17]=1,n[18]=0,n[19]=0,n[20]=1,n[21]=1,n[22]=0,n[23]=1,new VertexBuffer(e,n,{0:{size:2,type:"FLOAT",byteOffset:0},1:{size:2,type:"FLOAT",byteOffset:48}},{count:6})},setColorTarget=function(e,t,r,n){e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,e["COLOR_ATTACHMENT".concat(n)],e.TEXTURE_2D,r.texture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)},renderToScreen=function(e,t,r,n,i){r.use(),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),r.setUniform("uOpacity",i),r.setUniform("uTextureSampler",0),t.bind(0),n.bind(),n.draw(),n.unbind()},RenderBuffer=function(){function n(e,t,r){_classCallCheck(this,n),this.gl=e,this.framebuffer=e.createFramebuffer(),this.shader=new Shader(e,SHADER_GLSL),this.quad=createQuad(e,-1,1),this.texture=new Texture(e,null,{width:t,height:r,filter:"NEAREST",invertY:!1,premultiplyAlpha:!1}),setColorTarget(this.gl,this.framebuffer,this.texture,0)}return _createClass(n,[{key:"bind",value:function(){var e=this.gl;return e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),this}},{key:"unbind",value:function(){var e=this.gl;return e.bindFramebuffer(e.FRAMEBUFFER,null),this}},{key:"clear",value:function(){return this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this}},{key:"blitToScreen",value:function(e){return renderToScreen(this.gl,this.texture,this.shader,this.quad,e),this}},{key:"resize",value:function(e,t){return this.texture.resize(e,t),this}}]),n}();module.exports=RenderBuffer;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var o=_superPropBase(e,t);if(o){var n=Object.getOwnPropertyDescriptor(o,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var EventType=require("../../event/EventType"),Layer=require("../Layer"),CELL_UPDATE=Symbol(),CLIPPED=Symbol(),Overlay=function(e){function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,t)))[CLIPPED]=null,e[CELL_UPDATE]=null,e}return _inherits(r,Layer),_createClass(r,[{key:"onAdd",value:function(e){var t=this;return _get(_getPrototypeOf(r.prototype),"onAdd",this).call(this,e),this.refresh(),this[CELL_UPDATE]=function(){t.refresh()},this.plot.on(EventType.CELL_UPDATE,this[CELL_UPDATE]),this}},{key:"onRemove",value:function(e){return this[CLIPPED]=null,this.plot.removeListener(EventType.CELL_UPDATE,this[CELL_UPDATE]),this[CELL_UPDATE]=null,_get(_getPrototypeOf(r.prototype),"onRemove",this).call(this,e),this}},{key:"enable",value:function(){return this.show(),this}},{key:"disable",value:function(){return this.hide(),this}},{key:"isDisabled",value:function(){return this.isHidden()}},{key:"refresh",value:function(){return this.plot&&(this[CLIPPED]=this.clipGeometry(this.plot.cell)),_get(_getPrototypeOf(r.prototype),"refresh",this).call(this),this}},{key:"clipGeometry",value:function(e){throw"`clipGeometry` must be overridden"}},{key:"getClippedGeometry",value:function(){return this[CLIPPED]}}]),r}();module.exports=Overlay;
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Overlay=require("./Overlay"),clipPoints=function(r,t){var n=[];return t.forEach(function(t){var e=r.bounds.clipPoints(t);if(e)for(var o=0;o<e.length;o++)n.push(r.project(e[o]))}),n},PointOverlay=function(t){function o(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,o),(t=_possibleConstructorReturn(this,_getPrototypeOf(o).call(this,e))).points=new Map,t}return _inherits(o,Overlay),_createClass(o,[{key:"addPoints",value:function(t,e){return this.points.set(t,e),this.plot&&this.refresh(),this}},{key:"removePoints",value:function(t){return this.points.delete(t),this.plot&&this.refresh(),this}},{key:"clearPoints",value:function(){return this.clear(),this.points=new Map,this.plot&&this.refresh(),this}},{key:"clipGeometry",value:function(t){return clipPoints(t,this.points)}}]),o}();module.exports=PointOverlay;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Overlay=require("./Overlay"),clipPolygons=function(n,e){var i=[];return e.forEach(function(e){var t=n.bounds.clipPolygon(e);if(t){for(var o=new Array(t.length),r=0;r<t.length;r++)o[r]=n.project(t[r]);i.push(o)}}),i},PolygonOverlay=function(e){function o(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,o),(e=_possibleConstructorReturn(this,_getPrototypeOf(o).call(this,t))).polygons=new Map,e}return _inherits(o,Overlay),_createClass(o,[{key:"addPolygon",value:function(e,t){return this.polygons.set(e,t),this.plot&&this.refresh(),this}},{key:"removePolygon",value:function(e){return this.polygons.delete(e),this.plot&&this.refresh(),this}},{key:"clearPolygons",value:function(){return this.clear(),this.polygons=new Map,this.plot&&this.refresh(),this}},{key:"clipGeometry",value:function(e){return clipPolygons(e,this.polygons)}}]),o}();module.exports=PolygonOverlay;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Overlay=require("./Overlay"),clipPolylines=function(i,e){var l=[];return e.forEach(function(e){var t=i.bounds.clipPolyline(e);if(t)for(var r=0;r<t.length;r++){for(var o=t[r],n=0;n<o.length;n++)o[n]=i.project(o[n]);l.push(o)}}),l},PolylineOverlay=function(e){function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,t))).polylines=new Map,e}return _inherits(r,Overlay),_createClass(r,[{key:"addPolyline",value:function(e,t){return this.polylines.set(e,t),this.plot&&this.refresh(),this}},{key:"removePolyline",value:function(e){return this.polylines.delete(e),this.plot&&this.refresh(),this}},{key:"clearPolylines",value:function(){return this.clear(),this.polylines=new Map,this.plot&&this.refresh(),this}},{key:"clipGeometry",value:function(e){return clipPolylines(e,this.polylines)}}]),r}();module.exports=PolylineOverlay;
"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var MAX_SAFE_INT=Math.pow(2,53)-1,uid=1,getUID=function(){return uid=(uid+1)%MAX_SAFE_INT},Tile=function t(i){_classCallCheck(this,t),this.coord=i,this.uid=getUID(),this.data=null,this.err=null};module.exports=Tile;
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var mod=function(t,e){return(t%e+e)%e},TileCoord=function(){function s(t,e,n){_classCallCheck(this,s),this.z=t,this.x=e,this.y=n,this.hash="".concat(this.z,":").concat(this.x,":").concat(this.y)}return _createClass(s,[{key:"xyz",value:function(){var t=Math.pow(2,this.z);return"".concat(this.z,"/").concat(this.x,"/").concat(t-1-this.y)}},{key:"tms",value:function(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}},{key:"equals",value:function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}},{key:"getAncestor",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=Math.pow(2,t);return new s(this.z-t,Math.floor(this.x/e),Math.floor(this.y/e))}},{key:"getDescendants",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=Math.pow(2,t),n=new Array(e*e),i=0;i<e;i++)for(var r=i*e,o=0;o<e;o++)n[r+o]=new s(this.z+t,this.x*e+i,this.y*e+o);return n}},{key:"isAncestorOf",value:function(t){if(this.z>=t.z)return!1;var e=t.z-this.z,n=Math.pow(2,e),i=Math.floor(t.x/n);if(this.x!==i)return!1;var r=Math.floor(t.y/n);return this.y===r}},{key:"isDescendantOf",value:function(t){return t.isAncestorOf(this)}},{key:"normalize",value:function(){var t=Math.pow(2,this.z);return new s(this.z,mod(this.x,t),mod(this.y,t))}},{key:"getPosition",value:function(){var t=Math.pow(2,this.z);return{x:this.x/t,y:this.y/t}}},{key:"getCenter",value:function(){var t=Math.pow(2,this.z);return{x:(this.x+.5)/t,y:(this.y+.5)/t}}}]),s}();module.exports=TileCoord;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=_superPropBase(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var defaultTo=require("lodash/defaultTo"),Layer=require("../Layer"),TilePyramid=require("./TilePyramid"),requestVisibleTiles=function(e){var t=e.plot.getTargetVisibleCoords();e.requestTiles(t)},TileLayer=function(e){function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,t))).muted=defaultTo(t.muted,!1),e.pyramid=new TilePyramid(_assertThisInitialized(_assertThisInitialized(e)),t),e}return _inherits(r,Layer),_createClass(r,[{key:"onAdd",value:function(e){return _get(_getPrototypeOf(r.prototype),"onAdd",this).call(this,e),this.isMuted()||requestVisibleTiles(this),this}},{key:"onRemove",value:function(e){return this.pyramid.clear(),_get(_getPrototypeOf(r.prototype),"onRemove",this).call(this,e),this}},{key:"getPyramid",value:function(){return this.pyramid}},{key:"hide",value:function(){return _get(_getPrototypeOf(r.prototype),"hide",this).call(this),this}},{key:"mute",value:function(){return this.muted=!0,this}},{key:"unmute",value:function(){return this.isMuted()&&(this.muted=!1,this.plot&&requestVisibleTiles(this)),this}},{key:"isMuted",value:function(){return this.muted}},{key:"enable",value:function(){return this.show(),this.unmute(),this}},{key:"disable",value:function(){return this.hide(),this.mute(),this}},{key:"isDisabled",value:function(){return this.isMuted()&&this.isHidden()}},{key:"refresh",value:function(){return this.pyramid.clear(),this.plot&&!this.isMuted()&&requestVisibleTiles(this),_get(_getPrototypeOf(r.prototype),"refresh",this).call(this),this}},{key:"requestTile",value:function(e,t){t(null,null)}},{key:"requestTiles",value:function(e){return this.isMuted()||this.pyramid.requestTiles(e),this}}]),r}();module.exports=TileLayer;
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,n,r){return n&&_defineProperties(e.prototype,n),r&&_defineProperties(e,r),e}var TilePartial=function(){function t(e,n,r){_classCallCheck(this,t),this.target=e,this.tile=n,this.relative=r}return _createClass(t,null,[{key:"fromTile",value:function(e){return new t(e,e,null)}},{key:"fromAncestor",value:function(e,n,r){return new t(e,n,r)}},{key:"fromDescendant",value:function(e,n){return new t(e,n,null)}}]),t}();module.exports=TilePartial;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var defaultTo=require("lodash/defaultTo"),throttle=require("lodash/throttle"),EventType=require("../../event/EventType"),TileEvent=require("../../event/TileEvent"),LRUCache=require("../../util/LRUCache"),Tile=require("./Tile"),TilePartial=require("./TilePartial"),CACHE_SIZE=256,PERSISTANT_LEVELS=4,LOADED_THROTTLE_MS=200,MAX_DESCENDENT_DIST=4,add=function(e,t){if(t.coord.z<e.numPersistentLevels){if(e.persistents.has(t.coord.hash))throw"Tile of coord ".concat(t.coord.hash," already exists in the pyramid");e.persistents.set(t.coord.hash,t)}else{if(e.tiles.has(t.coord.hash))throw"Tile of coord ".concat(t.coord.hash," already exists in the pyramid");e.tiles.set(t.coord.hash,t)}e.levels.has(t.coord.z)||e.levels.set(t.coord.z,[]),e.levels.get(t.coord.z).push(t),e.layer.emit(EventType.TILE_ADD,new TileEvent(e.layer,t))},remove=function(e,t){if(t.coord.z<e.numPersistentLevels){if(!e.persistents.has(t.coord.hash))throw"Tile of coord ".concat(t.coord.hash," does not exists in the pyramid");e.persistents.delete(t.coord.hash)}var r=e.levels.get(t.coord.z);r.splice(r.indexOf(t),1),0===r.length&&e.levels.delete(t.coord.z),e.layer.emit(EventType.TILE_REMOVE,new TileEvent(e.layer,t))},sumPowerOfFour=function(e){return 1/3*(Math.pow(4,e)-1)},checkIfLoaded=function(e){0===e.pending.size&&e.emitLoad(new TileEvent(e.layer,null))},sortAroundCenter=function(e,t){var l=e.getTargetViewportCenter();return t.sort(function(e,t){var r=e.coord.getCenter(),i=t.coord.getCenter(),n=l.x-r.x,s=l.y-r.y,a=l.x-i.x,o=l.y-i.y;return n*n+s*s-(a*a+o*o)}),t},removeDuplicates=function(e){var r=new Map;return e.filter(function(e){var t=e.ncoord.hash;return!r.has(t)&&r.set(t,!0)})},removePendingOrExisting=function(t,e){return e.filter(function(e){return!t.get(e.ncoord)&&!t.isPending(e.ncoord)})},flagTileAsStale=function(e,t){var r=t.coord.hash,i=e.stale.get(r);i||(i=new Map,e.stale.set(r,i)),i.set(t.uid,!0)},isTileStale=function(e,t){var r=t.coord.hash,i=e.stale.get(r);return!(!i||!i.has(t.uid))&&(i.delete(t.uid),0===i.size&&e.stale.delete(r),!0)},shouldDiscard=function(e,t){var r=e.layer.plot;return!r||!r.getTargetViewport().isInView(t.coord,r.wraparound)},TilePyramid=function(){function i(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,i),!e)throw"No layer parameter provided";this.cacheSize=defaultTo(r.cacheSize,CACHE_SIZE),this.numPersistentLevels=defaultTo(r.numPersistentLevels,PERSISTANT_LEVELS),this.layer=e,this.levels=new Map,this.persistents=new Map,this.pending=new Map,this.stale=new Map,this.tiles=new LRUCache({capacity:this.cacheSize,onRemove:function(e){remove(t,e)}}),this.emitLoad=throttle(function(e){t.layer.emit(EventType.LOAD,e)},LOADED_THROTTLE_MS)}return _createClass(i,[{key:"getCapacity",value:function(){return this.cacheSize+sumPowerOfFour(this.numPersistentLevels)}},{key:"clear",value:function(){var t=this;this.pending.forEach(function(e){flagTileAsStale(t,e)}),this.pending=new Map,this.persistents.forEach(function(e){remove(t,e)}),this.persistents.clear(),this.tiles.clear()}},{key:"has",value:function(e){return e.z<this.numPersistentLevels?this.persistents.has(e.hash):this.tiles.has(e.hash)}},{key:"forEach",value:function(e){this.persistents.forEach(e),this.tiles.forEach(e)}},{key:"isPending",value:function(e){return this.pending.has(e.hash)}},{key:"get",value:function(e){return e.z<this.numPersistentLevels?this.persistents.get(e.hash):this.tiles.get(e.hash)}},{key:"getAncestor",value:function(e,t){var r=e.getAncestor(t);return this.get(r)}},{key:"getDescendants",value:function(e,t){for(var r=e.getDescendants(t),i=!1,n=0;n<r.length;n++)if(this.has(r[n])){i=!0;break}if(i){for(var s=new Array(r.length),a=0;a<r.length;a++){var o=r[a];s[a]=this.get(o)||o}return s}}},{key:"requestTiles",value:function(e){var n=this,t=e.map(function(e){return{coord:e,ncoord:e.normalize()}});t=removeDuplicates(t),t=removePendingOrExisting(this,t);for(var r=(t=sortAroundCenter(this.layer.plot,t)).map(function(e){var t=new Tile(e.ncoord);return n.pending.set(t.coord.hash,t),t}),i=function(e){var i=r[e];n.layer.emit(EventType.TILE_REQUEST,new TileEvent(n.layer,i)),n.layer.requestTile(i.coord,function(e,t){var r=isTileStale(n,i);return r||n.pending.delete(i.coord.hash),null!==e?(i.err=e,n.layer.emit(EventType.TILE_FAILURE,new TileEvent(n.layer,i)),void(r||checkIfLoaded(n))):(i.data=t,r||shouldDiscard(n,i)?(n.layer.emit(EventType.TILE_DISCARD,new TileEvent(n.layer,i)),void(r||checkIfLoaded(n))):(add(n,i),checkIfLoaded(n),void n.layer.plot.setDirty()))})},s=0;s<r.length;s++)i(s)}},{key:"getAvailableLOD",value:function(e){var t=this.get(e);if(t)return[TilePartial.fromTile(t)];var r=e.z,i=[];this.levels.forEach(function(e,t){t!==r&&i.push(t)}),i.sort(function(e,t){return(r<e?e-r:r-e-.5)-(r<t?t-r:r-t-.5)});for(var n=[],s=[],a=e,o=i.shift();void 0!==a&&void 0!==o;){if(o<a.z){var l=a.z-o,h=this.getAncestor(a,l);if(h){n.push(TilePartial.fromAncestor(e,h,a)),a=s.shift();continue}}else{if(o-r<MAX_DESCENDENT_DIST){var c=o-a.z,u=this.getDescendants(a,c);if(u){for(var d=0;d<u.length;d++){var f=u[d];f.coord?n.push(TilePartial.fromDescendant(e,f)):s.push(f)}a=s.shift()}}}o=i.shift()}return 0<n.length?n:void 0}}]),i}();module.exports=TilePyramid;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Animation=function(){function t(e){_classCallCheck(this,t),this.timestamp=Date.now(),this.duration=e.duration,this.plot=e.plot}return _createClass(t,[{key:"getT",value:function(e){return 0<this.duration?Math.min(1,(e-this.timestamp)/this.duration):1}},{key:"update",value:function(e){return!0}},{key:"cancel",value:function(){}},{key:"finish",value:function(){}}]),t}();module.exports=Animation;
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var EventType=require("../../event/EventType"),Event=require("../../event/Event"),Animation=require("./Animation"),PanAnimation=function(t){function n(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e))).start=e.start,t.delta=e.delta,t.end={x:t.start.x+t.delta.x,y:t.start.y+t.delta.y},t.easing=e.easing,t}return _inherits(n,Animation),_createClass(n,[{key:"update",value:function(t){var e=this.getT(t),n=1-Math.pow(1-e,1/this.easing),r=this.plot;r.viewport.x=this.start.x+this.delta.x*n,r.viewport.y=this.start.y+this.delta.y*n;var o=new Event(r);return e<1?(r.emit(EventType.PAN,o),!1):(r.emit(EventType.PAN_END,o),!0)}},{key:"cancel",value:function(){var t=this.plot;t.emit(EventType.PAN_END,new Event(t))}},{key:"finish",value:function(){var t=this.plot;t.viewport.x=this.end.x,t.viewport.y=this.end.y,t.emit(EventType.PAN_END,new Event(t))}}]),n}();module.exports=PanAnimation;
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var EventType=require("../../event/EventType"),Event=require("../../event/Event"),Animation=require("./Animation"),ZoomAnimation=function(t){function o(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,o),(t=_possibleConstructorReturn(this,_getPrototypeOf(o).call(this,e))).prevZoom=e.prevZoom,t.targetZoom=e.targetZoom,t.prevViewport=e.prevViewport,t.targetViewport=e.targetViewport,t.targetPos=e.targetPos,t}return _inherits(o,Animation),_createClass(o,[{key:"update",value:function(t){var e=this.getT(t),o=this.targetZoom-this.prevZoom,r=this.prevZoom+o*e,n=this.plot;n.zoom=r,n.viewport=this.prevViewport.zoomToPos(this.prevZoom,n.zoom,this.targetPos);var i=new Event(n);return e<1?(n.emit(EventType.ZOOM,i),!1):(n.emit(EventType.ZOOM_END,i),!0)}},{key:"cancel",value:function(){var t=this.plot;t.continuousZoom||(t.zoom=Math.round(t.zoom),t.viewport=this.prevViewport.zoomToPos(this.prevZoom,t.zoom,this.targetPos));var e=new Event(t);t.emit(EventType.ZOOM_END,e)}},{key:"finish",value:function(){var t=this.plot;t.zoom=this.targetZoom,t.viewport=this.targetViewport;var e=new Event(t);t.emit(EventType.ZOOM_END,e)}}]),o}();module.exports=ZoomAnimation;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=_superPropBase(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var EventType=require("../../event/EventType"),MouseEvent=require("../../event/MouseEvent"),DOMHandler=require("./DOMHandler"),MOVE_TOLERANCE=15,createEvent=function(e,t,n){return new MouseEvent(t,n,e.mouseToPlot(n),e.mouseToViewPx(n))},ClickHandler=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))}return _inherits(t,DOMHandler),_createClass(t,[{key:"enable",value:function(){var r=this;if(this.enabled)return this;var i=this.plot,u=null;this.mousedown=function(e){u=r.mouseToViewPx(e)},this.mouseup=function(e){if(u){var t=r.mouseToViewPx(e),n=u.x-t.x,o=u.y-t.y;n*n+o*o<MOVE_TOLERANCE*MOVE_TOLERANCE&&(i.setDirty(),e.preventDefault(),r.plot.emit(EventType.CLICK,createEvent(r,i,e))),u=null}},this.dblclick=function(e){i.setDirty(),e.preventDefault(),r.plot.emit(EventType.DBL_CLICK,createEvent(r,i,e))};var e=i.getContainer();return e.addEventListener("mousedown",this.mousedown),e.addEventListener("mouseup",this.mouseup),e.addEventListener("dblclick",this.dblclick),_get(_getPrototypeOf(t.prototype),"enable",this).call(this)}},{key:"disable",value:function(){if(!this.enabled)return this;var e=this.plot.getContainer();return e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("mouseup",this.mouseup),e.removeEventListener("dblclick",this.dblclick),this.mousedown=null,this.mouseup=null,this.dblclick=null,_get(_getPrototypeOf(t.prototype),"disable",this).call(this)}}]),t}();module.exports=ClickHandler;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var DOMHandler=function(){function t(e){_classCallCheck(this,t),this.plot=e,this.enabled=!1}return _createClass(t,[{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"mouseToPlot",value:function(e){return this.plot.mouseToPlotCoord(e)}},{key:"mouseToViewPx",value:function(e){return this.plot.mouseToViewportPixel(e)}},{key:"viewPxToPlot",value:function(e){return this.plot.viewportPixelToPlotCoord(e)}},{key:"plotToViewPx",value:function(e){return this.plot.plotCoordToViewportPixel(e)}},{key:"isLeftButton",value:function(e){return e.which?1===e.which:0===e.button}},{key:"isMiddleButton",value:function(e){return e.which?2===e.which:1===e.button}},{key:"isRightButton",value:function(e){return e.which?3===e.which:2===e.button}}]),t}();module.exports=DOMHandler;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,o){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var n=_superPropBase(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(o):r.value}})(e,t,o||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var EventType=require("../../event/EventType"),MouseEvent=require("../../event/MouseEvent"),DOMHandler=require("./DOMHandler"),createEvent=function(e,t,o){return new MouseEvent(t,o,e.mouseToPlot(o),e.mouseToViewPx(o))},MouseHandler=function(e){function n(e){return _classCallCheck(this,n),_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e))}return _inherits(n,DOMHandler),_createClass(n,[{key:"enable",value:function(){var t=this;if(this.enabled)return this;var o=this.plot;this.mousedown=function(e){o.setDirty(),e.preventDefault(),o.emit(EventType.MOUSE_DOWN,createEvent(t,o,e))},this.mouseup=function(e){o.setDirty(),e.preventDefault(),o.emit(EventType.MOUSE_UP,createEvent(t,o,e))},this.mousemove=function(e){o.setDirty(),e.preventDefault(),o.emit(EventType.MOUSE_MOVE,createEvent(t,o,e))},this.mouseover=function(e){o.setDirty(),e.preventDefault(),o.emit(EventType.MOUSE_OVER,createEvent(t,o,e))},this.mouseout=function(e){o.setDirty(),e.preventDefault(),o.emit(EventType.MOUSE_OUT,createEvent(t,o,e))},this.wheel=function(e){o.setDirty(),e.preventDefault()};var e=o.getContainer();return e.addEventListener("mousedown",this.mousedown),e.addEventListener("mouseup",this.mouseup),e.addEventListener("mousemove",this.mousemove),e.addEventListener("mouseover",this.mouseover),e.addEventListener("mouseout",this.mouseout),e.addEventListener("wheel",this.wheel),_get(_getPrototypeOf(n.prototype),"enable",this).call(this)}},{key:"disable",value:function(){if(!this.enabled)return this;var e=this.plot.getContainer();return e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("mouseup",this.mouseup),e.removeEventListener("mousemove",this.mousemove),e.removeEventListener("mouseover",this.mouseover),e.removeEventListener("mouseout",this.mouseout),e.removeEventListener("wheel",this.wheel),this.mousedown=null,this.mouseup=null,this.mousemove=null,this.mouseover=null,this.mouseout=null,this.wheel=null,_get(_getPrototypeOf(n.prototype),"disable",this).call(this)}}]),n}();module.exports=MouseHandler;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=_superPropBase(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var defaultTo=require("lodash/defaultTo"),PanAnimation=require("../animation/PanAnimation"),EventType=require("../../event/EventType"),Event=require("../../event/Event"),DOMHandler=require("./DOMHandler"),PAN_EXPIRY_MS=50,PAN_INTERTIA=!0,PAN_INTERTIA_EASING=.2,PAN_INTERTIA_DECELERATION=3400,PAN_TO_DURATION=800,pan=function(e,t){e.isZooming()||(e.viewport.x+=t.x,e.viewport.y+=t.y,e.panRequest(),e.emit(EventType.PAN,new Event(e)))},PanHandler=function(e){function o(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,o),(t=_possibleConstructorReturn(this,_getPrototypeOf(o).call(this,e))).inertia=defaultTo(n.inertia,PAN_INTERTIA),t.inertiaEasing=defaultTo(n.inertiaEasing,PAN_INTERTIA_EASING),t.inertiaDeceleration=defaultTo(n.inertiaDeceleration,PAN_INTERTIA_DECELERATION),t}return _inherits(o,DOMHandler),_createClass(o,[{key:"enable",value:function(){var f=this;if(this.enabled)return this;var c=this.plot,y=!1,_=null,m=null,v=[],h=[];return this.mousedown=function(e){f.isLeftButton(e)&&(y=!0,_=f.mouseToViewPx(e),m=Date.now(),f.inertia&&(c.panAnimation=null,v=[],h=[]))},this.mousemove=function(e){if(y){var t=f.mouseToViewPx(e),n=Date.now();0===v.length&&c.emit(EventType.PAN_START,new Event(c)),f.inertia&&(v.push(t),h.push(n),n-h[0]>PAN_EXPIRY_MS&&(v.shift(),h.shift()));var o={x:_.x-t.x,y:_.y-t.y};pan(c,f.viewPxToPlot(o)),m=n,_=t}},this.mouseup=function(e){if(y=!1,!c.isZooming()&&f.isLeftButton(e)&&0!==v.length)if(f.inertia){for(var t=Date.now();t-h[0]>PAN_EXPIRY_MS;)v.shift(),h.shift();if(h.length<2)c.emit(EventType.PAN_END,new Event(c));else{var n=f.inertiaDeceleration,o=f.inertiaEasing,i=_.x-v[0].x,r=_.y-v[0].y,a=(m-h[0]||1)/1e3,s=i*(o/a),u=r*(o/a),l=Math.sqrt(s*s+u*u)/(n*o),p={x:Math.round(s*(-l/2)),y:Math.round(u*(-l/2))};c.panAnimation=new PanAnimation({plot:c,start:c.getViewportPosition(),delta:f.viewPxToPlot(p),easing:o,duration:1e3*l})}}else c.emit(EventType.PAN_END,new Event(c))},c.getContainer().addEventListener("mousedown",this.mousedown),document.addEventListener("mousemove",this.mousemove),document.addEventListener("mouseup",this.mouseup),_get(_getPrototypeOf(o.prototype),"enable",this).call(this)}},{key:"disable",value:function(){return this.enabled?(this.plot.getContainer().removeEventListener("mousedown",this.mousedown),document.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup),this.mousedown=null,this.mousemove=null,this.mouseup=null,_get(_getPrototypeOf(o.prototype),"disable",this).call(this)):this}},{key:"panTo",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this.plot,o=n.getViewportCenter(),i={x:e.x-o.x,y:e.y-o.y};t?(n.emit(EventType.PAN_START,new Event(n)),n.panAnimation=new PanAnimation({plot:n,start:n.getViewportPosition(),delta:i,easing:this.inertiaEasing,duration:PAN_TO_DURATION})):(n.emit(EventType.PAN_START,new Event(n)),pan(n,i),n.emit(EventType.PAN_END,new Event(n)))}}]),o}();module.exports=PanHandler;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,o){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var r=_superPropBase(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(o):n.value}})(e,t,o||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var clamp=require("lodash/clamp"),defaultTo=require("lodash/defaultTo"),Browser=require("../../util/Browser"),EventType=require("../../event/EventType"),Event=require("../../event/Event"),ZoomAnimation=require("../animation/ZoomAnimation"),Viewport=require("../Viewport"),DOMHandler=require("./DOMHandler"),ZOOM_WHEEL_DELTA=300,ZOOM_ANIMATION_MS=250,MAX_CONCURRENT_ZOOMS=4,ZOOM_DEBOUNCE_MS=100,CONTINUOUS_ZOOM=!1,last=Date.now(),skipInterpolation=function(e,t){var o=Date.now(),r=o-last;return last=o,t%4.000244140625!=0&&(Math.abs(t)<4||(!e||0===e.duration)&&r<40)},computeZoomDelta=function(e,t,o,r){var n=e/o;return t||(n=0<e?Math.ceil(n):Math.floor(n)),clamp(n,-r,r)},computeTargetZoom=function(e,t,o,r,n){var i;return i=o?o.targetZoom+e:t+e,clamp(i,r,n)},zoom=function(e,t,o,r){var n=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],i=computeTargetZoom(o,e.zoom,e.zoomAnimation,e.minZoom,e.maxZoom),a=e.viewport.zoomToPos(e.zoom,i,t,n),l=e.getTargetZoom(),u=e.getTargetViewport();i===l&&a.x===u.x&&a.y===u.y||(e.panAnimation=null,0<r&&(e.zoomAnimation=new ZoomAnimation({plot:e,duration:r,prevZoom:e.zoom,targetZoom:i,prevViewport:new Viewport(e.viewport.x,e.viewport.y,e.viewport.width,e.viewport.height),targetViewport:a,targetPos:t})),e.emit(EventType.ZOOM_START,new Event(e)),0===r&&(e.zoom=i,e.viewport=a,e.emit(EventType.ZOOM_END,new Event(e))),e.zoomRequest())},zoomFromWheel=function(e,t,o,r,n){if(0!==r){var i=computeZoomDelta(r,n,e.deltaPerZoom,e.maxConcurrentZooms),a=e.zoomDuration;n&&skipInterpolation(t.zoomAnimation,r)&&(a=0),zoom(t,o,i,a)}},getWheelDelta=function(e,t){return 0===t.deltaMode?Browser.firefox?-t.deltaY/e.pixelRatio:-t.deltaY:1===t.deltaMode?20*-t.deltaY:60*-t.deltaY},ZoomHandler=function(e){function u(e){var t,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,u),(t=_possibleConstructorReturn(this,_getPrototypeOf(u).call(this,e))).continuousZoom=defaultTo(o.continuousZoom,CONTINUOUS_ZOOM),t.zoomDuration=defaultTo(o.zoomDuration,ZOOM_ANIMATION_MS),t.maxConcurrentZooms=defaultTo(o.maxConcurrentZooms,MAX_CONCURRENT_ZOOMS),t.deltaPerZoom=defaultTo(o.deltaPerZoom,ZOOM_WHEEL_DELTA),t.zoomDebounce=defaultTo(o.zoomDebounce,ZOOM_DEBOUNCE_MS),t}return _inherits(u,DOMHandler),_createClass(u,[{key:"enable",value:function(){var r=this;if(this.enabled)return this;var n=this.plot,i=0,a=null,l=null;this.dblclick=function(e){var t=r.mouseToPlot(e);zoom(n,t,1,r.zoomDuration)},this.wheel=function(e){var t=getWheelDelta(n,e);if(r.continuousZoom||!(Math.abs(t)<4)){if(i+=t,r.continuousZoom){var o=r.mouseToPlot(e);zoomFromWheel(r,n,o,i,!0),i=0}else l=e,a||(a=setTimeout(function(){var e=r.mouseToPlot(l);zoomFromWheel(r,n,e,i,!1),i=0,l=a=null},r.zoomDebounce));e.preventDefault(),e.stopPropagation()}};var e=n.getContainer();return e.addEventListener("dblclick",this.dblclick),e.addEventListener("wheel",this.wheel),_get(_getPrototypeOf(u.prototype),"enable",this).call(this)}},{key:"disable",value:function(){if(!this.enabled)return this;var e=this.plot.getContainer();return e.removeEventListener("dblclick",this.dblclick),e.removeEventListener("wheel",this.wheel),this.dblclick=null,this.wheel=null,_get(_getPrototypeOf(u.prototype),"disable",this).call(this)}},{key:"zoomTo",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=this.plot,r=this.plot.getViewportCenter(),n=e-o.zoom;zoom(o,r,n,t?this.zoomDuration:0)}},{key:"zoomToPosition",value:function(e,t){var o=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],r=this.plot,n=e-r.zoom,i=o?this.zoomDuration:0;zoom(r,t,n,i,!1)}}]),u}();module.exports=ZoomHandler;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Renderer=require("../Renderer"),OverlayRenderer=function(e){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).overlay=null,e}return _inherits(t,Renderer),_createClass(t,[{key:"onAdd",value:function(e){if(!e)throw"No overlay provided as argument";return this.overlay=e,this}},{key:"onRemove",value:function(e){if(!e)throw"No overlay provided as argument";return this.overlay=null,this}}]),t}();module.exports=OverlayRenderer;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var o=_superPropBase(e,t);if(o){var n=Object.getOwnPropertyDescriptor(o,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Shader=require("../../webgl/shader/Shader"),EventType=require("../../event/EventType"),OverlayRenderer=require("./OverlayRenderer"),REFRESH=Symbol(),WebGLOverlayRenderer=function(e){function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,t))).gl=null,e[REFRESH]=null,e}return _inherits(r,OverlayRenderer),_createClass(r,[{key:"onAdd",value:function(e){var t=this;return _get(_getPrototypeOf(r.prototype),"onAdd",this).call(this,e),this.gl=this.overlay.plot.getRenderingContext(),this.refreshBuffers(),this[REFRESH]=function(){t.refreshBuffers()},this.overlay.on(EventType.REFRESH,this[REFRESH]),this}},{key:"onRemove",value:function(e){return this.overlay.removeListener(EventType.REFRESH,this[REFRESH]),this[REFRESH]=null,this.gl=null,_get(_getPrototypeOf(r.prototype),"onRemove",this).call(this,e),this}},{key:"refreshBuffers",value:function(){throw"`refreshBuffers` must be overridden"}},{key:"createShader",value:function(e){return new Shader(this.gl,e)}},{key:"getOrthoMatrix",value:function(){return this.overlay.plot.getOrthoMatrix()}}]),r}();module.exports=WebGLOverlayRenderer;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var getUVOffset=function(e,t){var r=1/Math.pow(2,t.z-e.z);return[t.x*r-e.x,t.y*r-e.y,r,r]},TileRenderable=function(){function h(e,t,r,n){_classCallCheck(this,h),this.tile=e,this.hash=e.coord.hash,this.scale=t,this.tileOffset=r,this.uvOffset=n}return _createClass(h,[{key:"toCanvas",value:function(e,t){var r=this.uvOffset;r[1]=1-r[2]-r[1];var n=this.tileOffset;return n[1]=e.height-n[1]-t*this.scale,this}}],[{key:"fromTile",value:function(e,t,r,n,a){var o=r*n;return new h(e,r,[t.x*o-a.x,t.y*o-a.y],[0,0,1,1])}},{key:"fromAncestor",value:function(e,t,r,n,a,o,i){var s=r*n,f=[0,0];if(i===o)f[0]=t.x*s-a.x,f[1]=t.y*s-a.y;else{var l=1/Math.pow(2,i.z-o.z),c=i.x*l-o.x,u=i.y*l-o.y;f[0]=(t.x+c)*s-a.x,f[1]=(t.y+u)*s-a.y,r*=l}return new h(e,r,f,getUVOffset(e.coord,i))}},{key:"fromDescendant",value:function(e,t,r,n,a,o){var i=r*n,s=1/Math.pow(2,e.coord.z-o.z),f=e.coord.x*s-o.x,l=e.coord.y*s-o.y;return new h(e,r*s,[(t.x+f)*i-a.x,(t.y+l)*i-a.y],[0,0,1,1])}},{key:"fromAncestorPartial",value:function(e,t,r,n,a){var o=e.tile,i=e.target,s=e.relative,f=r*n,l=[0,0];if(s===e.target)l[0]=t.x*f-a.x,l[1]=t.y*f-a.y;else{var c=1/Math.pow(2,s.z-i.z),u=s.x*c-i.x,y=s.y*c-i.y;l[0]=(t.x+u)*f-a.x,l[1]=(t.y+y)*f-a.y,r*=c}return new h(o,r,l,getUVOffset(o.coord,s))}},{key:"fromDescendantPartial",value:function(e,t,r,n,a){var o=e.tile,i=e.target,s=r*n,f=1/Math.pow(2,o.coord.z-i.z),l=o.coord.x*f-i.x,c=o.coord.y*f-i.y;return new h(o,r*f,[(t.x+l)*s-a.x,(t.y+c)*s-a.y],[0,0,1,1])}}]),h}();module.exports=TileRenderable;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var EventType=require("../../event/EventType"),RTreePyramid=require("../../geometry/RTreePyramid"),Renderer=require("../Renderer"),TileRenderable=require("./TileRenderable"),TILE_INDEX=Symbol(),TILE_UNINDEX=Symbol(),TileRenderer=function(e){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))[TILE_INDEX]=new Map,e[TILE_UNINDEX]=new Map,e.layer=null,e}return _inherits(t,Renderer),_createClass(t,[{key:"onAdd",value:function(e){if(!e)throw"No layer provided as argument";return this.layer=e,this}},{key:"onRemove",value:function(e){if(!e)throw"No layer provided as argument";return this.layer=null,this}},{key:"createRTreePyramid",value:function(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},s=e.createCollidables;if(!s)throw"`options.createCollidables` argument is missing";var u=new RTreePyramid({nodeCapacity:e.nodeCapacity}),t=function(e){var t=e.tile,r=t.coord,o=a.layer.plot.tileSize,n=r.x*o,i=r.y*o,l=s(t,n,i);u.insert(r,l)},r=function(e){u.remove(e.tile.coord)};return this.layer.on(EventType.TILE_ADD,t),this.layer.on(EventType.TILE_REMOVE,r),this[TILE_INDEX].set(u,t),this[TILE_UNINDEX].set(u,r),u}},{key:"destroyRTreePyramid",value:function(e){this.layer.removeListener(EventType.TILE_ADD,this[TILE_INDEX].get(e)),this.layer.removeListener(EventType.TILE_REMOVE,this[TILE_UNINDEX].get(e)),this[TILE_INDEX].delete(e),this[TILE_UNINDEX].delete(e)}},{key:"getRenderables",value:function(){for(var e=this.layer.plot,t=this.layer.pyramid,r=e.tileSize,o=e.zoom,n=e.getViewportPixelOffset(),i=e.getVisibleCoords(),l=[],a=0;a<i.length;a++){var s=i[a],u=s.normalize(),f=t.get(u);if(f){var y=Math.pow(2,o-s.z),c=TileRenderable.fromTile(f,s,y,r,n);l.push(c)}}return l}},{key:"getRenderablesLOD",value:function(){for(var e=this.layer.plot,t=this.layer.pyramid,r=e.tileSize,o=e.zoom,n=e.getViewportPixelOffset(),i=e.getVisibleCoords(),l=[],a=0;a<i.length;a++){var s=i[a],u=s.normalize(),f=Math.pow(2,o-s.z),y=t.getAvailableLOD(u);if(y)for(var c=0;c<y.length;c++){var p=y[c],d=p.tile,h=void 0;h=d.coord.z===s.z?TileRenderable.fromTile(d,s,f,r,n):d.coord.z<s.z?TileRenderable.fromAncestorPartial(p,s,f,r,n):TileRenderable.fromDescendantPartial(p,s,f,r,n),l.push(h)}}return l}}]),t}();module.exports=TileRenderer;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var o=_superPropBase(e,t);if(o){var n=Object.getOwnPropertyDescriptor(o,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var defaultTo=require("lodash/defaultTo"),EventType=require("../../event/EventType"),Shader=require("../../webgl/shader/Shader"),TextureArray=require("../../webgl/texture/TextureArray"),VertexAtlas=require("../../webgl/vertex/VertexAtlas"),TileRenderer=require("./TileRenderer"),TILE_ADD=Symbol(),TILE_REMOVE=Symbol(),addTileToTextureArray=function(e,t){e.set(t.coord.hash,t.data)},removeTileFromTextureArray=function(e,t){e.delete(t.coord.hash)},addTileToVertexAtlas=function(e,t){e.set(t.coord.hash,t.data,t.data.length/e.stride)},removeTileFromVertexAtlas=function(e,t){e.delete(t.coord.hash)},WebGLTileRenderer=function(e){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).gl=null,e[TILE_ADD]=new Map,e[TILE_REMOVE]=new Map,e}return _inherits(t,TileRenderer),_createClass(t,[{key:"onAdd",value:function(e){return _get(_getPrototypeOf(t.prototype),"onAdd",this).call(this,e),this.gl=this.layer.plot.getRenderingContext(),this}},{key:"onRemove",value:function(e){return this.gl=null,_get(_getPrototypeOf(t.prototype),"onRemove",this).call(this,e),this}},{key:"getOrthoMatrix",value:function(){return this.layer.plot.getOrthoMatrix()}},{key:"createShader",value:function(e){return new Shader(this.gl,e)}},{key:"createTextureArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=new TextureArray(this.gl,{format:e.format,type:e.type,filter:e.filter,invertY:e.invertY,premultiplyAlpha:e.premultiplyAlpha},{numChunks:this.layer.pyramid.getCapacity(),chunkSize:e.chunkSize}),r=defaultTo(e.onAdd,addTileToTextureArray),o=defaultTo(e.onRemove,removeTileFromTextureArray),n=function(e){r(t,e.tile)},i=function(e){o(t,e.tile)};return this.layer.on(EventType.TILE_ADD,n),this.layer.on(EventType.TILE_REMOVE,i),this[TILE_ADD].set(t,n),this[TILE_REMOVE].set(t,i),t}},{key:"destroyTextureArray",value:function(e){this.layer.removeListener(EventType.TILE_ADD,this[TILE_ADD].get(e)),this.layer.removeListener(EventType.TILE_REMOVE,this[TILE_REMOVE].get(e)),this[TILE_ADD].delete(e),this[TILE_REMOVE].delete(e)}},{key:"createVertexAtlas",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=new VertexAtlas(this.gl,e.attributePointers,{numChunks:this.layer.pyramid.getCapacity(),chunkSize:e.chunkSize}),r=defaultTo(e.onAdd,addTileToVertexAtlas),o=defaultTo(e.onRemove,removeTileFromVertexAtlas),n=function(e){r(t,e.tile)},i=function(e){o(t,e.tile)};return this.layer.on(EventType.TILE_ADD,n),this.layer.on(EventType.TILE_REMOVE,i),this[TILE_ADD].set(t,n),this[TILE_REMOVE].set(t,i),t}},{key:"destroyVertexAtlas",value:function(e){this.layer.removeListener(EventType.TILE_ADD,this[TILE_ADD].get(e)),this.layer.removeListener(EventType.TILE_REMOVE,this[TILE_REMOVE].get(e)),this[TILE_ADD].delete(e),this[TILE_REMOVE].delete(e)}}]),t}();module.exports=WebGLTileRenderer;
"use strict";function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function _createClass(r,e,t){return e&&_defineProperties(r.prototype,e),t&&_defineProperties(r,t),r}var map=require("lodash/map"),parseShader=require("./parseShader"),UNIFORM_FUNCTIONS={bool:"uniform1i","bool[]":"uniform1iv",float:"uniform1f","float[]":"uniform1fv",int:"uniform1i","int[]":"uniform1iv",uint:"uniform1i","uint[]":"uniform1iv",vec2:"uniform2fv","vec2[]":"uniform2fv",ivec2:"uniform2iv","ivec2[]":"uniform2iv",vec3:"uniform3fv","vec3[]":"uniform3fv",ivec3:"uniform3iv","ivec3[]":"uniform3iv",vec4:"uniform4fv","vec4[]":"uniform4fv",ivec4:"uniform4iv","ivec4[]":"uniform4iv",mat2:"uniformMatrix2fv","mat2[]":"uniformMatrix2fv",mat3:"uniformMatrix3fv","mat3[]":"uniformMatrix3fv",mat4:"uniformMatrix4fv","mat4[]":"uniformMatrix4fv",sampler2D:"uniform1i",samplerCube:"uniform1i"},setAttributesAndUniforms=function(t,r,e){parseShader([r,e],["uniform","attribute"]).forEach(function(r){if("attribute"===r.qualifier)t.attributes.set(r.name,{type:r.type,index:t.attributes.size});else{var e=r.type+(1<r.count?"[]":"");t.uniforms.set(r.name,{type:r.type,func:UNIFORM_FUNCTIONS[e]})}})},formatLine=function(r,e){var t=e-(r=r.toString()).length;r+=":";for(var n=0;n<t;n++)r+=" ";return r},compileShader=function(r,e,t){var n=r.createShader(r[t]);if(r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS))return n;var i=e.split("\n"),o=i.length.toString().length+1,a=i.map(function(r,e){return"".concat(formatLine(e+1,o)," ").concat(r)}).join("\n"),f=r.getShaderInfoLog(n);throw"An error occurred compiling the shader:\n\n".concat(f.slice(0,f.length-1),"\n").concat(a)},bindAttributeLocations=function(t){var n=t.gl;t.attributes.forEach(function(r,e){n.bindAttribLocation(t.program,r.index,e)})},getUniformLocations=function(n){var i=n.gl,o=n.uniforms;o.forEach(function(r,e){var t=i.getUniformLocation(n.program,e);null===t?o.delete(e):r.location=t})},createDefines=function(r){return map(r,function(r,e){return"#define ".concat(e," ").concat(r)}).join("\n")},createProgram=function(r,e){var t=r.gl,n=createDefines(e.define)+(e.common||""),i=n+e.vert,o=n+e.frag,a=compileShader(t,i,"VERTEX_SHADER"),f=compileShader(t,o,"FRAGMENT_SHADER");if(setAttributesAndUniforms(r,i,o),r.program=t.createProgram(),t.attachShader(r.program,a),t.attachShader(r.program,f),bindAttributeLocations(r),t.linkProgram(r.program),!t.getProgramParameter(r.program,t.LINK_STATUS))throw"An error occured linking the shader:\n".concat(t.getProgramInfoLog(r.program));getUniformLocations(r)},Shader=function(){function t(r){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,t),!e.vert)throw"Vertex shader argument `vert` has not been provided";if(!e.frag)throw"Fragment shader argument `frag` has not been provided";this.gl=r,this.program=null,this.attributes=new Map,this.uniforms=new Map,createProgram(this,e)}return _createClass(t,[{key:"use",value:function(){return this.gl.useProgram(this.program),this}},{key:"setUniform",value:function(r,e){var t=this.uniforms.get(r);if(!t)throw"No uniform found under name `".concat(r,"`");if(null==e)throw"Value passed for uniform `".concat(r,"` is undefined or null");return"mat2"===t.type||"mat3"===t.type||"mat4"===t.type?this.gl[t.func](t.location,!1,e):this.gl[t.func](t.location,e),this}}]),t}();module.exports=Shader;
"use strict";var preprocess=require("./preprocess"),COMMENTS_REGEXP=/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,ENDLINE_REGEXP=/(\r\n|\n|\r)/gm,WHITESPACE_REGEXP=/\s{2,}/g,BRACKET_WHITESPACE_REGEXP=/(\s*)(\[)(\s*)(\d+)(\s*)(\])(\s*)/g,NAME_COUNT_REGEXP=/([a-zA-Z_][a-zA-Z0-9_]*)(?:\[(\d+)\])?/,PRECISION_REGEX=/\bprecision\s+\w+\s+\w+;/g,INLINE_PRECISION_REGEX=/\b(highp|mediump|lowp)\s+/g,stripComments=function(r){return r.replace(COMMENTS_REGEXP,"")},stripPrecision=function(r){return r.replace(PRECISION_REGEX,"").replace(INLINE_PRECISION_REGEX,"")},normalizeWhitespace=function(r){return r.replace(ENDLINE_REGEXP," ").replace(WHITESPACE_REGEXP," ").replace(BRACKET_WHITESPACE_REGEXP,"$2$4$6")},parseNameAndCount=function(r,e,t){var n=t.match(NAME_COUNT_REGEXP);return{qualifier:r,type:e,name:n[1],count:void 0===n[2]?1:parseInt(n[2],10)}},parseStatement=function(r){var e=r.split(",").map(function(r){return r.trim()}),t=e.shift().split(" "),n=t.shift(),E=t.shift();return t.concat(e).map(function(r){return parseNameAndCount(n,E,r)})},parseSource=function(r,e){var t=r.split(";"),n=e.join("|"),E=new RegExp("\\b("+n+")\\b.*"),a=[];return t.forEach(function(r){var e=r.match(E);e&&(a=a.concat(parseStatement(e[0])))}),a},filterDuplicatesByName=function(r){var e={};return r.filter(function(r){return!e[r.name]&&(e[r.name]=!0)})};module.exports=function(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(0===r.length||0===e.length)return[];r=Array.isArray(r)?r:[r],e=Array.isArray(e)?e:[e];var t=[];return r.forEach(function(r){r=stripComments(r),r=preprocess(r),r=stripPrecision(r),r=normalizeWhitespace(r),t=t.concat(parseSource(r,e))}),filterDuplicatesByName(t)};
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var i=0;i<n.length;i++){var t=n[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,n,i){return n&&_defineProperties(e.prototype,n),i&&_defineProperties(e,i),e}var DEFINED="__DEFINED__",DEFINE_REGEX=/#define\b/i,UNDEF_REGEX=/#undef\b/i,IF_REGEX=/#if\b/i,IFDEF_REGEX=/#ifdef\b/i,IFNDEF_REGEX=/#ifndef\b/i,ELSE_REGEX=/#else\b/i,ELIF_REGEX=/#elif\b/i,ENDIF_REGEX=/#endif\b/i,PARSE_DEFINE_REGEX=/#define\s+(\w+)(\s(\w*)?)?/i,PARSE_UNDEF_REGEX=/#undef\s+(\w+)/i,PARSE_IF_REGEX=/#if\s+\(?\s*(!?\s*\w+)\s*(==|!=|>=|<=|<|>)?\s*(\w*)\s*\)?/i,PARSE_IFDEF_REGEX=/#ifdef\s+(\w+)/i,PARSE_IFNDEF_REGEX=/#ifndef\s+(\w+)/i,PARSE_ELIF_REGEX=/#elif\s+\(?\s*(!?\s*\w+)\s*(==|!=|>=|<=|<|>)?\s*(\w*)\s*\)?/i,REMAINING_REGEX=/#([\W\w\s\d])(?:.*\\r?\n)*.*$/gm,evalIf=function(e,n,i){if(void 0===n)return"!"===e[0]?!("true"===e||1<=e):"true"===e||1<=e;switch(n){case"==":return e===i;case"!=":return e!==i;case">":return i<e;case">=":return i<=e;case"<":return e<i;case"<=":return e<=i}throw"Unrecognized logical operator `".concat(n,"`")},Conditional=function(){function i(e,n){_classCallCheck(this,i),this.type=e,this.conditional=n.trim(),this.body=[],this.children=[]}return _createClass(i,[{key:"eval",value:function(){var e;switch(this.type){case"if":return e=PARSE_IF_REGEX.exec(this.conditional),evalIf(e[1],e[2],e[3]);case"ifdef":return(e=PARSE_IFDEF_REGEX.exec(this.conditional))[1]===DEFINED;case"ifndef":return(e=PARSE_IFNDEF_REGEX.exec(this.conditional))[1]!==DEFINED;case"elif":return e=PARSE_ELIF_REGEX.exec(this.conditional),evalIf(e[1],e[2],e[3])}throw"Unrecognized conditional type `".concat(this.type,"`")}}]),i}(),Block=function(){function t(e,n,i){_classCallCheck(this,t),this.if=new Conditional(e,n),this.elif=[],this.else=null,this.parent=null,this.current=this.if,this.startLine=i,this.endLine=null}return _createClass(t,[{key:"addElse",value:function(e){this.current=new Conditional("else",e),this.else=this.current}},{key:"addElif",value:function(e){this.current=new Conditional("elif",e),this.elif.push(this.current)}},{key:"addBody",value:function(e,n){this.current.body.push({string:e.trim(),line:n})}},{key:"nest",value:function(e){(e.parent=this).current.children.push(e)}},{key:"extract",value:function(){var n=[];if(this.if.eval())return n=n.concat(this.if.body),this.if.children.forEach(function(e){n=n.concat(e.extract())}),n;for(var e=0;e<this.elif.length;e++){var i=this.elif[e];if(i.eval()){n=n.concat(i.body);for(var t=0;t<i.children.length;t++){var r=i.children[t];n=n.concat(r.extract())}return n}}return this.else?(n=n.concat(this.else.body),this.else.children.forEach(function(e){n=n.concat(e.extract())}),n):[]}},{key:"eval",value:function(){return this.extract().sort(function(e,n){return e.line-n.line}).map(function(e){return e.string}).join("\n")}}]),t}(),parseLines=function(e){var s=[],a=null;if(e.forEach(function(e,n){if(e.match(IF_REGEX)){var i=new Block("if",e,n);a?a.nest(i):s.push(i),a=i}else if(e.match(IFDEF_REGEX)){var t=new Block("ifdef",e,n);a?a.nest(t):s.push(t),a=t}else if(e.match(IFNDEF_REGEX)){var r=new Block("ifndef",e,n);a?a.nest(r):s.push(r),a=r}else if(e.match(ELIF_REGEX)){if(!a)throw"Invalid preprocessor syntax, unexpected `#elif`";a.addElif(e)}else if(e.match(ELSE_REGEX)){if(!a)throw"Invalid preprocessor syntax, unexpected `#else`";a.addElse(e)}else if(e.match(ENDIF_REGEX)){if(!a)throw"Invalid preprocessor syntax, unexpected `#endif`";a.endLine=n,a=a.parent}else a&&a.addBody(e,n)}),a)throw"Invalid preprocessor syntax, missing expected `#endif`";return s},replaceDefines=function(e){var s=new Map,a=[];return e.forEach(function(i){if(i.match(DEFINE_REGEX)){var e=PARSE_DEFINE_REGEX.exec(i);s.set(e[1],e[2]||DEFINED)}else if(i.match(UNDEF_REGEX)){var n=PARSE_UNDEF_REGEX.exec(i);s.delete(n[1])}else if(i.match(IFDEF_REGEX)){var t=PARSE_IFDEF_REGEX.exec(i);s.has(t[1])&&(i=i.replace(t[1],DEFINED)),a.push(i)}else if(i.match(IFNDEF_REGEX)){var r=PARSE_IFNDEF_REGEX.exec(i);s.has(r[1])&&(i=i.replace(r[1],DEFINED)),a.push(i)}else s.forEach(function(e,n){i=i.replace(n,e)}),a.push(i)}),a};module.exports=function(e){var n=e.split("\n");n=replaceDefines(n);for(var i=parseLines(n),t=i.length-1;0<=t;t--){var r=i[t],s=r.eval();0<s.length?n.splice(r.startLine,r.endLine-r.startLine+1,s):n.splice(r.startLine,r.endLine-r.startLine+1)}return n.join("\n").replace(REMAINING_REGEX,"")};
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var defaultTo=require("lodash/defaultTo"),Texture=function(){function r(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,r),this.gl=t,this.texture=t.createTexture(),this.format=defaultTo(i.format,"RGBA"),this.type=defaultTo(i.type,"UNSIGNED_BYTE"),this.filter=defaultTo(i.filter,"LINEAR"),this.wrap=defaultTo(i.wrap,"CLAMP_TO_EDGE"),this.invertY=defaultTo(i.invertY,!1),this.premultiplyAlpha=defaultTo(i.premultiplyAlpha,!1),this.bufferData(e,i.width,i.height),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[this.wrap]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[this.wrap]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[this.filter]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[this.filter])}return _createClass(r,[{key:"bind",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=this.gl;return e.activeTexture(e["TEXTURE".concat(t)]),e.bindTexture(e.TEXTURE_2D,this.texture),this}},{key:"unbind",value:function(){var t=this.gl;return t.bindTexture(t.TEXTURE_2D,null),this}},{key:"bufferData",value:function(t,e,i){var r=this.gl;return r.bindTexture(r.TEXTURE_2D,this.texture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.invertY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t&&t.width&&t.height?(this.width=t.width,this.height=t.height,r.texImage2D(r.TEXTURE_2D,0,r[this.format],r[this.format],r[this.type],t)):(this.width=e||this.width,this.height=i||this.height,r.texImage2D(r.TEXTURE_2D,0,r[this.format],this.width,this.height,0,r[this.format],r[this.type],t)),this}},{key:"bufferSubData",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0,h=4<arguments.length&&void 0!==arguments[4]?arguments[4]:void 0,a=this.gl;return a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,this.invertY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t.width&&t.height?a.texSubImage2D(a.TEXTURE_2D,0,e,i,a[this.format],a[this.type],t):a.texSubImage2D(a.TEXTURE_2D,0,e,i,r,h,a[this.format],a[this.type],t),this}},{key:"resize",value:function(t,e){return this.bufferData(null,t,e),this}}]),r}();module.exports=Texture;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var defaultTo=require("lodash/defaultTo"),createTexture=function(e,t,i,r,a,s,h,n){var u=e.createTexture();return e.bindTexture(e.TEXTURE_2D,u),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,h),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),e.texImage2D(e.TEXTURE_2D,0,e[t],i,i,0,e[t],e[r],null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e[s]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e[s]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e[a]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[a]),u},TextureArray=function(){function a(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,a),this.gl=e,this.chunkSize=defaultTo(i.chunkSize,256),this.numChunks=defaultTo(i.numChunks,256),this.format=defaultTo(t.format,"RGBA"),this.type=defaultTo(t.type,"UNSIGNED_BYTE"),this.filter=defaultTo(t.filter,"LINEAR"),this.wrap=defaultTo(t.wrap,"CLAMP_TO_EDGE"),this.invertY=defaultTo(t.invertY,!1),this.premultiplyAlpha=defaultTo(t.premultiplyAlpha,!1),this.available=new Array(this.numChunks);for(var r=0;r<this.numChunks;r++)this.available[r]={texture:createTexture(this.gl,this.format,this.chunkSize,this.type,this.filter,this.wrap,this.invertY,this.premultiplyAlpha)};this.used=new Map}return _createClass(a,[{key:"has",value:function(e){return this.used.has(e)}},{key:"get",value:function(e){return this.used.get(e)}},{key:"set",value:function(e,t){if(this.has(e))throw"Tile of coord ".concat(e," already exists in the array");if(0===this.available.length)throw"No available texture chunks in array";var i=this.available.pop(),r=this.gl;r.bindTexture(r.TEXTURE_2D,i.texture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.invertY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t.width&&t.height?r.texImage2D(r.TEXTURE_2D,0,r[this.format],r[this.format],r[this.type],t):r.texImage2D(r.TEXTURE_2D,0,r[this.format],this.chunkSize,this.chunkSize,0,r[this.format],r[this.type],t),this.used.set(e,i)}},{key:"delete",value:function(e){if(!this.has(e))throw"Tile of coord ".concat(e," does not exist in the array");var t=this.used.get(e);return this.used.delete(e),this.available.push(t),this}},{key:"bind",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(!this.has(e))throw"Tile of coord ".concat(e," does not exist in the array");var i=this.gl,r=this.used.get(e);return i.activeTexture(i["TEXTURE".concat(t)]),i.bindTexture(i.TEXTURE_2D,r.texture),this}},{key:"unbind",value:function(){return this}}]),a}();module.exports=TextureArray;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var f=0;f<t.length;f++){var r=t[f];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,f){return t&&_defineProperties(e.prototype,t),f&&_defineProperties(e,f),e}var defaultTo=require("lodash/defaultTo"),IndexBuffer=function(){function r(e,t){var f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,r),this.gl=e,this.type=defaultTo(f.type,"UNSIGNED_SHORT"),this.mode=defaultTo(f.mode,"TRIANGLES"),this.count=defaultTo(f.count,0),this.byteOffset=defaultTo(f.byteOffset,0),t instanceof WebGLBuffer?this.buffer=t:(this.buffer=e.createBuffer(),t&&this.bufferData(t))}return _createClass(r,[{key:"bufferData",value:function(e){var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)}},{key:"bufferSubData",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,f=this.gl;return f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.buffer),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,t,e),this}},{key:"draw",value:function(){var e=this.gl;return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.buffer),e.drawElements(e[this.mode],this.count,e[this.type],this.byteOffset),this}}]),r}();module.exports=IndexBuffer;
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var defaultTo=require("lodash/defaultTo"),forIn=require("lodash/forIn"),BYTES_PER_TYPE={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,FIXED:4,FLOAT:4},calcChunkByteSize=function(t,e){var i=0;return t.forEach(function(t){i+=BYTES_PER_TYPE[t.type]*t.size*e}),i},calcByteOffsets=function(i,t,n){var r=0;t.forEach(function(t,e){i.byteOffsets[e]=n+r,r+=BYTES_PER_TYPE[t.type]*t.size})},calcStride=function(t){var e=0;return t.forEach(function(t){e+=t.size}),e},parseAttributePointers=function(t){var i=new Map,n=0;return forIn(t,function(t,e){i.set(e,{type:t.type,size:t.size,byteOffset:n,byteStride:0}),n+=BYTES_PER_TYPE[t.type]*t.size}),i.forEach(function(t){t.byteStride=n}),i},VertexAtlas=function(){function u(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(_classCallCheck(this,u),this.gl=t,this.ext=t.getExtension("ANGLE_instanced_arrays"),!this.ext)throw"ANGLE_instanced_arrays WebGL extension is not supported";if(this.chunkSize=defaultTo(i.chunkSize,16384),this.numChunks=defaultTo(i.numChunks,256),!e)throw"No attribute pointers provided";this.pointers=parseAttributePointers(e),this.stride=calcStride(this.pointers),this.available=new Array(this.numChunks);for(var n=calcChunkByteSize(this.pointers,this.chunkSize),r=0;r<this.numChunks;r++){var s=r*n,a={count:0,chunkOffset:r*this.chunkSize,chunkByteOffset:s,byteOffsets:{}};calcByteOffsets(a,this.pointers,s),this.available[r]=a}this.used=new Map,this.buffer=t.createBuffer();var o=n*this.numChunks;t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,o,t.DYNAMIC_DRAW)}return _createClass(u,[{key:"has",value:function(t){return this.used.has(t)}},{key:"get",value:function(t){return this.used.get(t)}},{key:"set",value:function(t,e,i){if(this.has(t))throw"Tile of coord ".concat(t," already exists in the atlas");if(0===this.available.length)throw"No available vertex chunks in atlas";if(i>this.chunkSize)throw"Data count of ".concat(i," is greater that allocated size of ").concat(this.chunkSize);var n=this.available.pop();if(0<(n.count=i)){var r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,this.buffer),r.bufferSubData(r.ARRAY_BUFFER,n.chunkByteOffset,e)}this.used.set(t,n)}},{key:"delete",value:function(t){if(!this.has(t))throw"Tile of coord ".concat(t," does not exist in the atlas");var e=this.used.get(t);return this.used.delete(t),this.available.push(e),this}},{key:"bind",value:function(){var i=this.gl;return i.bindBuffer(i.ARRAY_BUFFER,this.buffer),this.pointers.forEach(function(t,e){i.enableVertexAttribArray(e),i.vertexAttribPointer(e,t.size,i[t.type],!1,t.byteStride,t.byteOffset)}),this}},{key:"bindInstanced",value:function(){var i=this.gl,n=this.ext;return i.bindBuffer(i.ARRAY_BUFFER,this.buffer),this.pointers.forEach(function(t,e){i.enableVertexAttribArray(e),n.vertexAttribDivisorANGLE(e,1)}),this}},{key:"unbind",value:function(){var i=this.gl;return this.pointers.forEach(function(t,e){i.disableVertexAttribArray(e)}),this}},{key:"unbindInstanced",value:function(){var i=this.gl,n=this.ext;return this.pointers.forEach(function(t,e){i.disableVertexAttribArray(e),n.vertexAttribDivisorANGLE(e,0)}),this}},{key:"draw",value:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;if(!this.has(t))throw"Tile of coord ".concat(t," does not exist in the atlas");var r=this.gl,s=this.used.get(t);0<s.count&&r.drawArrays(r[e],s.chunkOffset+i,n||s.count)}},{key:"drawInstanced",value:function(t,e,i){if(!this.has(t))throw"Tile of coord ".concat(t," does not exist in the atlas");var n=this.gl,r=this.ext,s=this.used.get(t);this.pointers.forEach(function(t,e){n.vertexAttribPointer(e,t.size,n[t.type],!1,t.byteStride,s.byteOffsets[e])}),0<s.count&&r.drawArraysInstancedANGLE(n[e],0,i,s.count)}}]),u}();module.exports=VertexAtlas;
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var defaultTo=require("lodash/defaultTo"),forIn=require("lodash/forIn"),BYTES_PER_TYPE={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,FIXED:4,FLOAT:4},getStride=function(e){if(1===e.size)return 0;var n=0,f=0,s=0;return e.forEach(function(e){var t=e.byteOffset,r=e.size,i=e.type;f+=r*BYTES_PER_TYPE[i],n<t&&(s=(n=t)+r*BYTES_PER_TYPE[i])}),f<=n?0:s},getAttributePointers=function(e){var i=new Map;return forIn(e,function(e,t){var r=parseInt(t,10);e.byteOffset=defaultTo(e.byteOffset,0),i.set(r,e)}),i},VertexBuffer=function(){function n(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};_classCallCheck(this,n),this.gl=e,this.mode=defaultTo(i.mode,"TRIANGLES"),this.count=defaultTo(i.count,0),this.indexOffset=defaultTo(i.indexOffset,0),this.pointers=getAttributePointers(r),this.byteStride=getStride(this.pointers),t instanceof WebGLBuffer?this.buffer=t:(this.buffer=e.createBuffer(),t&&this.bufferData(t))}return _createClass(n,[{key:"bufferData",value:function(e){var t=this.gl;return t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),this}},{key:"bufferSubData",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=this.gl;return r.bindBuffer(r.ARRAY_BUFFER,this.buffer),r.bufferSubData(r.ARRAY_BUFFER,t,e),this}},{key:"bind",value:function(){var r=this,i=this.gl;return i.bindBuffer(i.ARRAY_BUFFER,this.buffer),this.pointers.forEach(function(e,t){i.vertexAttribPointer(t,e.size,i[e.type],!1,r.byteStride,e.byteOffset),i.enableVertexAttribArray(t)}),this}},{key:"unbind",value:function(){var r=this.gl;return this.pointers.forEach(function(e,t){r.disableVertexAttribArray(t)}),this}},{key:"draw",value:function(){var e=this.gl;return e.drawArrays(e[this.mode],this.indexOffset,this.count),this}}]),n}();module.exports=VertexBuffer;
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,o){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var n=_superPropBase(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(o):r.value}})(t,e,o||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var defaultTo=require("lodash/defaultTo"),VertexBuffer=require("../../../webgl/vertex/VertexBuffer"),WebGLOverlayRenderer=require("../WebGLOverlayRenderer"),SHADER_GLSL={vert:"\n\t\tprecision highp float;\n\t\tattribute vec2 aPosition;\n\t\tattribute vec2 aNormal;\n\t\tuniform vec2 uViewOffset;\n\t\tuniform float uScale;\n\t\tuniform float uLineWidth;\n\t\tuniform float uPixelRatio;\n\t\tuniform float uPointRadius;\n\t\tuniform mat4 uProjectionMatrix;\n\t\tvoid main() {\n\t\t\tvec2 wPosition = (aPosition * uScale) - uViewOffset;\n\t\t\tgl_Position = uProjectionMatrix * vec4(wPosition, 0.0, 1.0);\n\t\t\tgl_PointSize = uPointRadius * 2.0 * uPixelRatio;\n\t\t}\n\t\t",frag:"\n\t\t#ifdef GL_OES_standard_derivatives\n\t\t\t#extension GL_OES_standard_derivatives : enable\n\t\t#endif\n\t\tprecision highp float;\n\t\tuniform vec4 uPointColor;\n\t\tuniform float uOpacity;\n\t\tvoid main() {\n\t\t\tvec2 cxy = 2.0 * gl_PointCoord - 1.0;\n\t\t\tfloat radius = dot(cxy, cxy);\n\t\t\tfloat alpha = 1.0;\n\t\t\t#ifdef GL_OES_standard_derivatives\n\t\t\t\tfloat delta = fwidth(radius);\n\t\t\t\talpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, radius);\n\t\t\t#else\n\t\t\t\tif (radius > 1.0) {\n\t\t\t\t\tdiscard;\n\t\t\t\t}\n\t\t\t#endif\n\t\t\tgl_FragColor = vec4(uPointColor.rgb, uPointColor.a * alpha * uOpacity);\n\t\t}\n\t\t"},bufferPoints=function(t){for(var e=new Float32Array(2*t.length),o=0;o<t.length;o++){var n=t[o];e[2*o]=n.x,e[2*o+1]=n.y}return e},createVertexBuffer=function(t,e){var o=bufferPoints(e);return new VertexBuffer(t,o,{0:{size:2,type:"FLOAT"}},{mode:"POINTS",count:e.length})},PointOverlayRenderer=function(t){function o(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,o),(t=_possibleConstructorReturn(this,_getPrototypeOf(o).call(this,e))).pointColor=defaultTo(e.pointColor,[1,0,1,1]),t.pointRadius=defaultTo(e.pointRadius,4),t.shader=null,t.ext=null,t.points=null,t}return _inherits(o,WebGLOverlayRenderer),_createClass(o,[{key:"onAdd",value:function(t){return _get(_getPrototypeOf(o.prototype),"onAdd",this).call(this,t),this.ext=this.gl.getExtension("OES_standard_derivatives"),this.shader=this.createShader(SHADER_GLSL),this}},{key:"onRemove",value:function(t){return this.shader=null,this.ext=null,this.points=null,_get(_getPrototypeOf(o.prototype),"onRemove",this).call(this,t),this}},{key:"refreshBuffers",value:function(){var t=this.overlay.getClippedGeometry();t&&0<t.length?this.points=createVertexBuffer(this.gl,t):this.points=null}},{key:"draw",value:function(){if(!this.points)return this;var t=this.gl,e=this.shader,o=this.points,n=this.overlay.plot,r=n.cell,i=this.getOrthoMatrix(),a=Math.pow(2,n.zoom-r.zoom),u=this.overlay.opacity,s=r.project(n.viewport,n.zoom);return t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),e.use(),e.setUniform("uProjectionMatrix",i),e.setUniform("uViewOffset",[s.x,s.y]),e.setUniform("uScale",a),e.setUniform("uPointColor",this.pointColor),e.setUniform("uPointRadius",this.pointRadius),e.setUniform("uPixelRatio",n.pixelRatio),e.setUniform("uOpacity",u),o.bind(),o.draw(),this}}]),o}();module.exports=PointOverlayRenderer;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var o=_superPropBase(e,t);if(o){var n=Object.getOwnPropertyDescriptor(o,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var earcut=require("earcut"),defaultTo=require("lodash/defaultTo"),VertexBuffer=require("../../../webgl/vertex/VertexBuffer"),IndexBuffer=require("../../../webgl/vertex/IndexBuffer"),WebGLOverlayRenderer=require("../WebGLOverlayRenderer"),SHADER_GLSL={vert:"\n\t\tprecision highp float;\n\t\tattribute vec2 aPosition;\n\t\tuniform vec2 uViewOffset;\n\t\tuniform float uScale;\n\t\tuniform mat4 uProjectionMatrix;\n\t\tvoid main() {\n\t\t\tvec2 wPosition = (aPosition * uScale) - uViewOffset;\n\t\t\tgl_Position = uProjectionMatrix * vec4(wPosition, 0.0, 1.0);\n\t\t}\n\t\t",frag:"\n\t\tprecision highp float;\n\t\tuniform vec4 uPolygonColor;\n\t\tuniform float uOpacity;\n\t\tvoid main() {\n\t\t\tgl_FragColor = vec4(uPolygonColor.rgb, uPolygonColor.a * uOpacity);\n\t\t}\n\t\t"},getVertexArray=function(e){for(var t=new Float32Array(2*e.length),r=0;r<e.length;r++)t[2*r]=e[r].x,t[2*r+1]=e[r].y;return t},createBuffers=function(e,t){var r=getVertexArray(t),o=earcut(r),n=new VertexBuffer(e.gl,r,{0:{size:2,type:"FLOAT"}}),i=r.length<Math.pow(2,16);return{vertex:n,index:new IndexBuffer(e.gl,i?new Uint16Array(o):new Uint32Array(o),{mode:"TRIANGLES",type:i?"UNSIGNED_SHORT":"UNSIGNED_INT",count:o.length})}},PolygonOverlayRenderer=function(e){function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,t))).polygonColor=defaultTo(t.polygonColor,[1,.4,.1,.8]),e.shader=null,e.polygons=null,e}return _inherits(r,WebGLOverlayRenderer),_createClass(r,[{key:"onAdd",value:function(e){return _get(_getPrototypeOf(r.prototype),"onAdd",this).call(this,e),this.shader=this.createShader(SHADER_GLSL),this}},{key:"onRemove",value:function(e){return _get(_getPrototypeOf(r.prototype),"onRemove",this).call(this,e),this.shader=null,this}},{key:"refreshBuffers",value:function(){var t=this,e=this.overlay.getClippedGeometry();this.polygons=e?e.map(function(e){return createBuffers(t,e)}):null}},{key:"draw",value:function(){if(!this.polygons)return this;var e=this.gl,t=this.shader,r=this.polygons,o=this.overlay.plot,n=o.cell,i=this.getOrthoMatrix(),u=Math.pow(2,o.zoom-n.zoom),l=this.overlay.opacity,f=n.project(o.viewport,o.zoom);return e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),t.use(),t.setUniform("uProjectionMatrix",i),t.setUniform("uViewOffset",[f.x,f.y]),t.setUniform("uScale",u),t.setUniform("uPolygonColor",this.polygonColor),t.setUniform("uOpacity",l),r.forEach(function(e){e.vertex.bind(),e.index.draw()}),this}}]),r}();module.exports=PolygonOverlayRenderer;
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=_superPropBase(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var defaultTo=require("lodash/defaultTo"),VertexBuffer=require("../../../webgl/vertex/VertexBuffer"),WebGLOverlayRenderer=require("../WebGLOverlayRenderer"),SHADER_GLSL={vert:"\n\t\tprecision highp float;\n\t\tattribute vec2 aPosition;\n\t\tattribute vec2 aNormal;\n\t\tuniform vec2 uViewOffset;\n\t\tuniform float uScale;\n\t\tuniform float uLineWidth;\n\t\tuniform mat4 uProjectionMatrix;\n\t\tvoid main() {\n\t\t\tvec2 wPosition = (aPosition * uScale) - uViewOffset + aNormal * uLineWidth;\n\t\t\tgl_Position = uProjectionMatrix * vec4(wPosition, 0.0, 1.0);\n\t\t}\n\t\t",frag:"\n\t\tprecision highp float;\n\t\tuniform vec4 uLineColor;\n\t\tuniform float uOpacity;\n\t\tvoid main() {\n\t\t\tgl_FragColor = vec4(uLineColor.rgb, uLineColor.a * uOpacity);\n\t\t}\n\t\t"},EPSILON=1e-6,scalarMult=function(t,e){return{x:t.x*e,y:t.y*e}},perpendicular=function(t){return{x:-t.y,y:t.x}},invert=function(t){return{x:-t.x,y:-t.y}},length=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},normalize=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x/e,y:t.y/e}},add=function(t,e){return{x:t.x+e.x,y:t.y+e.y}},sub=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},middle=function(t,e){return scalarMult(add(t,e),.5)},equal=function(t,e){return t.x===e.x&&t.y===e.y},signedArea=function(t,e,r){return(e.x-t.x)*(r.y-t.y)-(r.x-t.x)*(e.y-t.y)},getStrokeGeometry=function(t,e){if(t.length<2)throw"A valid polyline must consist of at least 2 points";var r=e/2,n=[],o=[],u=[],i=!1;if(2===t.length)createTriangles(t[0],middle(t[0],t[1]),t[1],n,o,r);else{if(equal(t[0],t[t.length-1])){var s=middle(t.shift(),t[0]);t.unshift(s),t.push(s),i=!0}for(var a=0;a<t.length-1;a++)0===a?u.push(t[0]):a===t.length-2?u.push(t[t.length-1]):u.push(middle(t[a],t[a+1]));for(var l=1;l<u.length;l++)createTriangles(u[l-1],t[l],u[l],n,o,r)}if(!i){var h=t[0],p=t[1],f=perpendicular(sub(p,h));createRoundCap(h,add(h,f),sub(h,f),p,n,o),h=t[t.length-1],p=t[t.length-2],f=perpendicular(sub(p,h)),createRoundCap(h,add(h,f),sub(h,f),p,n,o)}return{positions:n,normals:o}},createRoundCap=function(t,e,r,n,o,u){var i=Math.atan2(r.y-t.y,r.x-t.x),s=Math.atan2(e.y-t.y,e.x-t.x),a=i;i<s?s-i>=Math.PI-EPSILON&&(s-=2*Math.PI):i-s>=Math.PI-EPSILON&&(i-=2*Math.PI);var l=s-i;if(Math.abs(l)>=Math.PI-EPSILON&&Math.abs(l)<=Math.PI+EPSILON){var h=sub(t,n);0===h.x?0<h.y&&(l=-l):h.x>=-EPSILON&&(l=-l)}for(var p=Math.ceil(16*Math.abs(l/Math.PI)),f=l/p,c={x:0,y:0},y=0;y<p;y++){var d={x:Math.cos(a+f*y),y:Math.sin(a+f*y)},v={x:Math.cos(a+f*(1+y)),y:Math.sin(a+f*(1+y))};o.push(t),o.push(t),o.push(t),u.push(c),u.push(d),u.push(v)}};function lineIntersection(t,e,r,n){var o=e.y-t.y,u=t.x-e.x,i=n.y-r.y,s=r.x-n.x,a=o*s-i*u;if(-EPSILON<a&&a<EPSILON)return null;var l=o*t.x+u*t.y,h=i*r.x+s*r.y;return{x:(s*l-u*h)/a,y:(o*h-i*l)/a}}function createTriangles(t,e,r,n,o,u){var i=sub(e,t),s=sub(r,e);i=perpendicular(i),s=perpendicular(s),0<signedArea(t,e,r)&&(i=invert(i),s=invert(s)),i=normalize(i),s=normalize(s),i=scalarMult(i,u),s=scalarMult(s,u);var a=lineIntersection(add(i,t),add(i,e),add(s,r),add(s,e)),l=null,h=Number.MAX_VALUE,p=null;a&&(l=sub(a,e),h=length(l),p=invert(scalarMult(l,1/u)));var f=sub(t,e),c=length(f),y=sub(e,r),d=length(y),v=normalize(i),b=invert(v),x=normalize(s),g=invert(x);c<h||d<h?(n.push(t),n.push(t),n.push(e),o.push(v),o.push(b),o.push(v),n.push(t),n.push(e),n.push(e),o.push(b),o.push(v),o.push(b),createRoundCap(e,add(e,i),add(e,s),r,n,o),n.push(r),n.push(e),n.push(e),o.push(x),o.push(g),o.push(x),n.push(r),n.push(e),n.push(r),o.push(x),o.push(g)):(n.push(t),n.push(t),n.push(e),o.push(v),o.push(b),o.push(p),n.push(t),n.push(e),n.push(e),o.push(v),o.push(p),o.push(v),n.push(e),n.push(e),n.push(e),o.push(v),o.push({x:0,y:0}),o.push(p),createRoundCap(e,add(e,i),add(e,s),sub(e,l),n,o),n.push(e),n.push(e),n.push(e),o.push({x:0,y:0}),o.push(x),o.push(p),n.push(r),n.push(e),n.push(e),o.push(x),o.push(p),o.push(x),n.push(r),n.push(e),n.push(r),o.push(x),o.push(p)),o.push(g)}var bufferPolyline=function(t,e){for(var r=new Float32Array(4*t.length),n=0;n<t.length;n++){var o=t[n],u=e[n];r[4*n]=o.x,r[4*n+1]=o.y,r[4*n+2]=u.x,r[4*n+3]=u.y}return r},createVertexBuffer=function(t,e){var r=t.lineWidth,n=getStrokeGeometry(e,r),o=bufferPolyline(n.positions,n.normals);return new VertexBuffer(t.gl,o,{0:{size:2,type:"FLOAT",byteOffset:0},1:{size:2,type:"FLOAT",byteOffset:8}},{mode:"TRIANGLES",count:n.positions.length})},PolylineOverlayRenderer=function(t){function r(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(t=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,e))).lineColor=defaultTo(e.lineColor,[1,.4,.1,.8]),t.lineWidth=defaultTo(e.lineWidth,2),t.shader=null,t.lines=null,t}return _inherits(r,WebGLOverlayRenderer),_createClass(r,[{key:"onAdd",value:function(t){return _get(_getPrototypeOf(r.prototype),"onAdd",this).call(this,t),this.shader=this.createShader(SHADER_GLSL),this}},{key:"onRemove",value:function(t){return _get(_getPrototypeOf(r.prototype),"onRemove",this).call(this,t),this.shader=null,this}},{key:"refreshBuffers",value:function(){var e=this,t=this.overlay.getClippedGeometry();this.lines=t?t.map(function(t){return createVertexBuffer(e,t)}):null}},{key:"draw",value:function(){if(!this.lines)return this;var t=this.gl,e=this.shader,r=this.lines,n=this.overlay.plot,o=n.cell,u=this.getOrthoMatrix(),i=Math.pow(2,n.zoom-o.zoom),s=this.overlay.opacity,a=o.project(n.viewport,n.zoom);return t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),e.use(),e.setUniform("uProjectionMatrix",u),e.setUniform("uViewOffset",[a.x,a.y]),e.setUniform("uScale",i),e.setUniform("uLineWidth",this.lineWidth/2),e.setUniform("uLineColor",this.lineColor),e.setUniform("uOpacity",s),r.forEach(function(t){t.bind(),t.draw()}),this}}]),r}();module.exports=PolylineOverlayRenderer;
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var o=_superPropBase(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var VertexBuffer=require("../../../webgl/vertex/VertexBuffer"),WebGLTileRenderer=require("../WebGLTileRenderer"),SHADER_GLSL={vert:"\n\t\tprecision highp float;\n\t\tattribute vec2 aPosition;\n\t\tattribute vec2 aTextureCoord;\n\t\tuniform vec4 uTextureCoordOffset;\n\t\tuniform vec2 uTileOffset;\n\t\tuniform float uScale;\n\t\tuniform mat4 uProjectionMatrix;\n\t\tvarying vec2 vTextureCoord;\n\t\tvoid main() {\n\t\t\tvTextureCoord = vec2(\n\t\t\t\tuTextureCoordOffset.x + (aTextureCoord.x * uTextureCoordOffset.z),\n\t\t\t\tuTextureCoordOffset.y + (aTextureCoord.y * uTextureCoordOffset.w));\n\t\t\tvec2 wPosition = (aPosition * uScale) + uTileOffset;\n\t\t\tgl_Position = uProjectionMatrix * vec4(wPosition, 0.0, 1.0);\n\t\t}\n\t\t",frag:"\n\t\tprecision highp float;\n\t\tuniform sampler2D uTextureSampler;\n\t\tuniform float uOpacity;\n\t\tvarying vec2 vTextureCoord;\n\t\tvoid main() {\n\t\t\tvec4 color = texture2D(uTextureSampler, vec2(vTextureCoord.x, 1.0 - vTextureCoord.y));\n\t\t\tgl_FragColor = vec4(color.rgb, color.a * uOpacity);\n\t\t}\n\t\t"},createQuad=function(t,e,r){var o=new Float32Array(24);return o[0]=e,o[1]=e,o[2]=r,o[3]=e,o[4]=r,o[5]=r,o[6]=e,o[7]=e,o[8]=r,o[9]=r,o[10]=e,o[11]=r,o[12]=0,o[13]=0,o[14]=1,o[15]=0,o[16]=1,o[17]=1,o[18]=0,o[19]=0,o[20]=1,o[21]=1,o[22]=0,o[23]=1,new VertexBuffer(t,o,{0:{size:2,type:"FLOAT",byteOffset:0},1:{size:2,type:"FLOAT",byteOffset:48}},{count:6})},ImageTileRenderer=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).quad=null,t.shader=null,t.array=null,t}return _inherits(e,WebGLTileRenderer),_createClass(e,[{key:"onAdd",value:function(t){return _get(_getPrototypeOf(e.prototype),"onAdd",this).call(this,t),this.quad=createQuad(this.gl,0,t.plot.tileSize),this.shader=this.createShader(SHADER_GLSL),this.array=this.createTextureArray({chunkSize:t.plot.tileSize}),this}},{key:"onRemove",value:function(t){return this.destroyTextureArray(this.array),this.array=null,this.quad=null,this.shader=null,_get(_getPrototypeOf(e.prototype),"onRemove",this).call(this,t),this}},{key:"draw",value:function(){var t=this.gl,e=this.shader,r=this.array,o=this.quad,n=this.getRenderablesLOD(),i=this.getOrthoMatrix();e.use(),e.setUniform("uProjectionMatrix",i),e.setUniform("uTextureSampler",0),e.setUniform("uOpacity",this.layer.opacity),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),o.bind();for(var u=0;u<n.length;u++){var a=n[u];r.bind(a.hash,0),e.setUniform("uTextureCoordOffset",a.uvOffset),e.setUniform("uScale",a.scale),e.setUniform("uTileOffset",a.tileOffset),o.draw()}return o.unbind(),this}}]),e}();module.exports=ImageTileRenderer;
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=_superPropBase(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var defaultTo=require("lodash/defaultTo"),VertexBuffer=require("../../../webgl/vertex/VertexBuffer"),WebGLTileRenderer=require("../WebGLTileRenderer"),CHUNK_SIZE=16384,STAR_INNER_RADIUS=.4,STAR_OUTER_RADIUS=1,STAR_NUM_POINTS=5,SHADER_GLSL={vert:"\n\t\tprecision highp float;\n\t\tattribute vec2 aPosition;\n\t\tattribute vec2 aOffset;\n\t\tattribute float aRadius;\n\t\tuniform vec2 uTileOffset;\n\t\tuniform float uScale;\n\t\tuniform mat4 uProjectionMatrix;\n\t\tvoid main() {\n\t\t\tvec2 wPosition = (aPosition * aRadius) + (aOffset * uScale) + uTileOffset;\n\t\t\tgl_Position = uProjectionMatrix * vec4(wPosition, 0.0, 1.0);\n\t\t}\n\t\t",frag:"\n\t\tprecision highp float;\n\t\tuniform vec4 uColor;\n\t\tvoid main() {\n\t\t\tgl_FragColor = uColor;\n\t\t}\n\t\t"},createStar=function(t){var e=2*Math.PI/STAR_NUM_POINTS,r=e/2,n=e/4,o=new Float32Array(2*STAR_NUM_POINTS*2+4);o[0]=0;for(var i=o[1]=0;i<STAR_NUM_POINTS;i++){var s=i*e,a=Math.cos(s-n)*STAR_INNER_RADIUS,l=Math.sin(s-n)*STAR_INNER_RADIUS;o[4*i+2]=a,o[4*i+1+2]=l,a=Math.cos(s+r-n)*STAR_OUTER_RADIUS,l=Math.sin(s+r-n)*STAR_OUTER_RADIUS,o[4*i+2+2]=a,o[4*i+3+2]=l}return o[o.length-2]=o[2],o[o.length-1]=o[3],new VertexBuffer(t,o,{0:{size:2,type:"FLOAT"}},{mode:"TRIANGLE_FAN",count:o.length/2})},InstancedTileRenderer=function(t){function r(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(t=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this))).color=defaultTo(e.color,[1,.4,.1,.8]),t.shape=null,t.shader=null,t.atlas=null,t}return _inherits(r,WebGLTileRenderer),_createClass(r,[{key:"onAdd",value:function(t){return _get(_getPrototypeOf(r.prototype),"onAdd",this).call(this,t),this.shape=createStar(this.gl),this.shader=this.createShader(SHADER_GLSL),this.atlas=this.createVertexAtlas({chunkSize:CHUNK_SIZE,attributePointers:{1:{size:2,type:"FLOAT"},2:{size:1,type:"FLOAT"}}}),this}},{key:"onRemove",value:function(t){return this.destroyVertexAtlas(this.atlas),this.atlas=null,this.shape=null,this.shader=null,_get(_getPrototypeOf(r.prototype),"onRemove",this).call(this,t),this}},{key:"draw",value:function(){var t=this.gl,e=this.shader,r=this.atlas,n=this.shape,o=this.getRenderables(),i=this.getOrthoMatrix();t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),e.use(),e.setUniform("uProjectionMatrix",i),e.setUniform("uColor",this.color),n.bind(),r.bindInstanced();for(var s=0;s<o.length;s++){var a=o[s];e.setUniform("uScale",a.scale),e.setUniform("uTileOffset",a.tileOffset),r.drawInstanced(a.hash,n.mode,n.count)}return r.unbindInstanced(),n.unbind(),this}}]),r}();module.exports=InstancedTileRenderer;
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var i=_superPropBase(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var defaultTo=require("lodash/defaultTo"),CircleCollidable=require("../../../geometry/CircleCollidable"),VertexBuffer=require("../../../webgl/vertex/VertexBuffer"),WebGLTileRenderer=require("../WebGLTileRenderer"),CHUNK_SIZE=16384,HIGHLIGHTED_RADIUS_OFFSET=2,SELECTED_RADIUS_OFFSET=4,NODE_CAPACITY=32,SHADER_GLSL={vert:"\n\t\tprecision highp float;\n\t\tattribute vec2 aPosition;\n\t\tattribute float aRadius;\n\t\tuniform float uRadiusOffset;\n\t\tuniform vec2 uTileOffset;\n\t\tuniform float uScale;\n\t\tuniform float uPixelRatio;\n\t\tuniform mat4 uProjectionMatrix;\n\t\tvoid main() {\n\t\t\tvec2 wPosition = (aPosition * uScale) + uTileOffset;\n\t\t\tgl_PointSize = (aRadius + uRadiusOffset) * uScale * 2.0 * uPixelRatio;\n\t\t\tgl_Position = uProjectionMatrix * vec4(wPosition, 0.0, 1.0);\n\t\t}\n\t\t",frag:"\n\t\t#ifdef GL_OES_standard_derivatives\n\t\t\t#extension GL_OES_standard_derivatives : enable\n\t\t#endif\n\t\tprecision highp float;\n\t\tuniform vec4 uColor;\n\t\tvoid main() {\n\t\t\tvec2 cxy = 2.0 * gl_PointCoord - 1.0;\n\t\t\tfloat radius = dot(cxy, cxy);\n\t\t\tfloat alpha = 1.0;\n\t\t\t#ifdef GL_OES_standard_derivatives\n\t\t\t\tfloat delta = fwidth(radius);\n\t\t\t\talpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, radius);\n\t\t\t#else\n\t\t\t\tif (radius > 1.0) {\n\t\t\t\t\tdiscard;\n\t\t\t\t}\n\t\t\t#endif\n\t\t\tgl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\n\t\t}\n\t\t"},createPoint=function(t){var e=new Float32Array(2);return e[0]=0,e[1]=0,new VertexBuffer(t,e,{0:{size:2,type:"FLOAT"}},{mode:"POINTS",count:1})},createCollidables=function(t,e,r){for(var i=t.data,n=new Array(i.length/3),o=0;o<i.length;o+=3)n[o/3]=new CircleCollidable(i[o],i[o+1],i[o+2],e,r,t);return n},renderTiles=function(t,e,r,i){e.setUniform("uColor",i),e.setUniform("uRadiusOffset",0),t.bind();for(var n=0;n<r.length;n++){var o=r[n];e.setUniform("uScale",o.scale),e.setUniform("uTileOffset",o.tileOffset),t.draw(o.hash,"POINTS")}t.unbind()},renderPoint=function(t,e,r,i,n,o){var l=i.tile.coord,a=Math.pow(2,r.zoom-l.z),s=r.getViewportPixelOffset(),u=[(l.x*r.tileSize+i.x)*a-s.x,(l.y*r.tileSize+i.y)*a-s.y];e.setUniform("uTileOffset",u),e.setUniform("uScale",a),e.setUniform("uColor",n),e.setUniform("uRadiusOffset",o+i.radius),t.bind(),t.draw(),t.unbind()},InteractiveTileRenderer=function(t){function r(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(t=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this))).color=defaultTo(e.color,[1,.4,.1,.8]),t.shader=null,t.point=null,t.tree=null,t.atlas=null,t.ext=null,t}return _inherits(r,WebGLTileRenderer),_createClass(r,[{key:"onAdd",value:function(t){return _get(_getPrototypeOf(r.prototype),"onAdd",this).call(this,t),this.ext=this.gl.getExtension("OES_standard_derivatives"),this.point=createPoint(this.gl),this.shader=this.createShader(SHADER_GLSL),this.tree=this.createRTreePyramid({nodeCapacity:NODE_CAPACITY,createCollidables:createCollidables}),this.atlas=this.createVertexAtlas({chunkSize:CHUNK_SIZE,attributePointers:{0:{size:2,type:"FLOAT"},1:{size:1,type:"FLOAT"}}}),this}},{key:"onRemove",value:function(t){return this.destroyVertexAtlas(this.atlas),this.destroyRTreePyramid(this.tree),this.atlas=null,this.shader=null,this.point=null,this.tree=null,this.ext=null,_get(_getPrototypeOf(r.prototype),"onRemove",this).call(this,t),this}},{key:"pick",value:function(t){return this.layer.plot.isZooming()?null:this.tree.searchPoint(t.x,t.y,this.layer.plot.zoom,this.layer.plot.getPixelExtent())}},{key:"draw",value:function(){var e=this,t=this.gl,r=this.layer,i=r.plot,n=this.getOrthoMatrix(),o=this.shader;i.renderBuffer.bind(),i.renderBuffer.clear(),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE),o.use(),o.setUniform("uProjectionMatrix",n),o.setUniform("uPixelRatio",i.pixelRatio),renderTiles(this.atlas,o,this.getRenderables(),this.color),r.getSelected().forEach(function(t){renderPoint(e.point,o,i,t,e.color,SELECTED_RADIUS_OFFSET)});var l=r.getHighlighted();return l&&!r.isSelected(l)&&renderPoint(this.point,o,i,l,this.color,HIGHLIGHTED_RADIUS_OFFSET),i.renderBuffer.unbind(),i.renderBuffer.blitToScreen(this.layer.opacity),this}}]),r}();module.exports=InteractiveTileRenderer;
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=_superPropBase(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var defaultTo=require("lodash/defaultTo"),WebGLTileRenderer=require("../WebGLTileRenderer"),CHUNK_SIZE=16384,SHADER_GLSL={vert:"\n\t\tprecision highp float;\n\t\tattribute vec2 aPosition;\n\t\tattribute float aRadius;\n\t\tuniform vec2 uTileOffset;\n\t\tuniform float uScale;\n\t\tuniform float uPixelRatio;\n\t\tuniform mat4 uProjectionMatrix;\n\t\tvoid main() {\n\t\t\tvec2 wPosition = (aPosition * uScale) + uTileOffset;\n\t\t\tgl_PointSize = aRadius * 2.0 * uPixelRatio;\n\t\t\tgl_Position = uProjectionMatrix * vec4(wPosition, 0.0, 1.0);\n\t\t}\n\t\t",frag:"\n\t\t#ifdef GL_OES_standard_derivatives\n\t\t\t#extension GL_OES_standard_derivatives : enable\n\t\t#endif\n\t\tprecision highp float;\n\t\tuniform vec4 uColor;\n\t\tvoid main() {\n\t\t\tvec2 cxy = 2.0 * gl_PointCoord - 1.0;\n\t\t\tfloat radius = dot(cxy, cxy);\n\t\t\tfloat alpha = 1.0;\n\t\t\t#ifdef GL_OES_standard_derivatives\n\t\t\t\tfloat delta = fwidth(radius);\n\t\t\t\talpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, radius);\n\t\t\t#else\n\t\t\t\tif (radius > 1.0) {\n\t\t\t\t\tdiscard;\n\t\t\t\t}\n\t\t\t#endif\n\t\t\tgl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\n\t\t}\n\t\t"},PointTileRenderer=function(t){function r(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(t=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this))).color=defaultTo(e.color,[1,.4,.1,.8]),t.shader=null,t.atlas=null,t.ext=null,t}return _inherits(r,WebGLTileRenderer),_createClass(r,[{key:"onAdd",value:function(t){return _get(_getPrototypeOf(r.prototype),"onAdd",this).call(this,t),this.ext=this.gl.getExtension("OES_standard_derivatives"),this.shader=this.createShader(SHADER_GLSL),this.atlas=this.createVertexAtlas({chunkSize:CHUNK_SIZE,attributePointers:{0:{size:2,type:"FLOAT"},1:{size:1,type:"FLOAT"}}}),this}},{key:"onRemove",value:function(t){return this.destroyVertexAtlas(this.atlas),this.atlas=null,this.shader=null,this.ext=null,_get(_getPrototypeOf(r.prototype),"onRemove",this).call(this,t),this}},{key:"draw",value:function(){var t=this.gl,e=this.shader,r=this.atlas,n=this.layer.plot,o=this.getRenderables(),i=this.getOrthoMatrix();n.renderBuffer.bind(),n.renderBuffer.clear(),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE),e.use(),e.setUniform("uProjectionMatrix",i),e.setUniform("uColor",this.color),e.setUniform("uPixelRatio",n.pixelRatio),r.bind();for(var a=0;a<o.length;a++){var s=o[a];e.setUniform("uScale",s.scale),e.setUniform("uTileOffset",s.tileOffset),r.draw(s.hash,"POINTS")}return r.unbind(),n.renderBuffer.unbind(),n.renderBuffer.blitToScreen(this.layer.opacity),this}}]),r}();module.exports=PointTileRenderer;